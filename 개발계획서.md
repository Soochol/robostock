# 주식 장기투자 모델 개발 계획서

## 1. 프로젝트 개요

### 1.1 목적

- **산업 변화 트렌드 포착**: 거래량 블록(1번+2번) 발생으로 자금 유입 시그널 탐지
- **장기 고수익 종목 선별**: 50% 이상 상승 가능성이 높은 종목 사전 식별
- **AI 기반 의사결정**: 비지도/지도 학습으로 팩터 분석 및 패턴 예측

### 1.2 목표

- **1번+2번 거래량 블록 자동 탐지**: 10년간 KOSPI/KOSDAQ 전 종목 분석
- **수익률 구간별 차별 팩터 발견**: 비지도 학습으로 Level 1~4(50%~1000%+) 구분 요인 도출
- **성공 패턴 예측 시스템**: 지도 학습으로 알려진 성공 패턴 템플릿 기반 신규 케이스 성공 확률 계산
- **백테스팅 검증**: 과거 10년 데이터로 전략 유효성 검증 및 최적화

## 2. 분석 팩터 정의

> **핵심 전략**: 산업 변화 트렌드의 시작을 확인하고 투자
> - 트렌드 변화/시작 판단 기준: **종목/섹터/산업에 자금 유입 여부**

### 2.1 핵심 시그널: 거래량 블록

> **정의**: 대규모 거래량 발생을 통한 주가 트렌드 변화 포착
> **의미**: 산업 변화 트렌드의 시작 → **역사적 최대 거래량 발생이 핵심 시그널**

#### 2.1.1 1번 거래량 블록 (트렌드 변화 시작)

> **정의**: 대규모 거래량 발생을 통한 주가 트렌드 변화 포착
> **의미**: 산업 변화 트렌드의 시작 → **역사적 최대 거래량 발생이 핵심 시그널**

#### 2.1.1 주가 트렌드 변화의 탐지

> **모델링 정의**: 산업 변화 트렌드 시작을 알리는 **자금 유입 시그널 이벤트**

- **1번 거래량 블록**

  - **정의**: 2년래 최대 거래량
  - **목적**: 이상(anomaly) 거래량 발생 시점 탐지

  - **D일 거래량**
    - `d_volume`: D일 거래량
    - `d_volume_vs_2y_max`: 2년래 최대 거래량 대비 비율 (%) - 100% 이상이어야 함
    - `is_2y_max`: 2년래 최대 거래량 여부 (Boolean)
    - `d_date`: D일 날짜

  - **D일 거래대금**
    - **조건**: D일 거래대금 ≥ 500억원
    - **포인트 시스템**: 거래대금에 따라 선형 점수 부여
    - `d_trading_value`: D일 거래대금 (억원)
    - `is_500b_value`: 거래대금 500억원 이상 여부 (Boolean)
    - `trading_value_score`: 거래대금 점수 (10점 만점)
      - 500억원 = 1점
      - 1,000억원 = 2.8점
      - 1,500억원 = 4.6점
      - 2,000억원 = 6.4점
      - 2,500억원 = 8.2점
      - 3,000억원 이상 = 10점
      - 계산식: `min(10, (d_trading_value - 500) / 250 * 9 + 1)`

  - **D일 가격 데이터**
    - `d_open`: D일 시가
    - `d_close`: D일 종가
    - `d_high`: D일 고가
    - `d_low`: D일 저가

  - **D일 신고가 분석** (1번 블록 기준)
    - `is_new_high_2y`: 2년래 신고가 여부 (Boolean)
    - `max_2y`: 2년 내 최고가

  - **D일 수급 분석**
    - `d_institutional_net_buy`: 기관 순매수 금액 (원)
    - `d_foreign_net_buy`: 외국인 순매수 금액 (원)
    - `d_foreign_institutional_net_buy`: 외국인+기관 순매수 금액 (원)
    - `d_individual_net_buy`: 개인 순매수 금액 (원)
    - `d_program_net_buy`: 프로그램 순매수 금액 (원)
    - `d_institutional_buying_strength`: 기관 매수강세 지수 (순매수금액/총거래대금 × 100, %)
    - `d_foreign_buying_strength`: 외국인 매수강세 지수 (순매수금액/총거래대금 × 100, %)
    - `d_foreign_institutional_buying_strength`: 외국인+기관 매수강세 지수 (순매수금액/총거래대금 × 100, %)
    - `d_individual_buying_strength`: 개인 매수강세 지수 (순매수금액/총거래대금 × 100, %)
    - `d_program_buying_strength`: 프로그램 매수강세 지수 (순매수금액/총거래대금 × 100, %)

  - **1번 거래량 확정 조건**
    - `is_2y_max = True` (2년래 최대 거래량)
    - `is_500b_value = True` (거래대금 500억원 이상)
    - **위 2가지 조건 모두 만족 시 1번 거래량 블록 확정**

- **2번 거래량 블록**
  - **정의**: 1번 거래량 블록 발생 이후 6개월 내, 특정 패턴 조건과 가격 조건을 충족하는 거래량
  - **목적**: 트렌드 변화 시작 및 자금 유입 지속성 확인

  - **트리거 거래량 D (D-Day)**
    - **정의**: 1번 거래량 블록 발생 이후 6개월 내 발생, 1번 거래량 블록의 거래량 대비 80% 이상
    - **D 거래량 조건**: `d_volume >= primary_d_volume × 0.8` (1번 블록 D일 거래량의 80% 이상)
    - **D 거래대금 조건**: `d_trading_value >= 500억원` (거래대금 500억원 이상)
    - **중요**: D+1 조건이 충족되어야 비로소 **D가 정의**됨 (최소 D+1까지 확인 필수)
  
    - **D일 거래량**
      - `d_volume`: D일 거래량
      - `d_volume_vs_primary`: 1번 거래량 블록 D일 거래량 대비 비율 (%)
      - `is_80pct_of_primary`: 1번 거래량 블록 대비 80% 이상 여부 (Boolean)
      - `days_from_primary`: 1번 거래량 블록 발생일로부터 경과 일수
      - `is_within_6months`: 6개월 내 발생 여부 (Boolean)

    - **D일 거래대금**
      - **조건**: 트리거 거래량 발생일 거래대금 ≥ 500억원
      - **포인트 시스템**: 거래대금에 따라 선형 점수 부여
      - `d_trading_value`: D일 거래대금 (억원)
      - `is_500b_value`: 거래대금 500억원 이상 여부 (Boolean)
      - `trading_value_score`: 거래대금 점수 (10점 만점)
        - 500억원 = 1점
        - 1,000억원 = 2.8점
        - 1,500억원 = 4.6점
        - 2,000억원 = 6.4점
        - 2,500억원 = 8.2점
        - 3,000억원 이상 = 10점
        - 계산식: `min(10, (d_trading_value - 500) / 250 * 9 + 1)`

    - **D일 가격 데이터**
      - `d_open`: D일 시가
      - `d_close`: D일 종가
      - `d_high`: D일 고가
      - `d_low`: D일 저가

    - **D일 수급 분석**
      - `d_institutional_net_buy`: 기관 순매수 금액 (원)
      - `d_foreign_net_buy`: 외국인 순매수 금액 (원)
      - `d_foreign_institutional_net_buy`: 외국인+기관 순매수 금액 (원)
      - `d_individual_net_buy`: 개인 순매수 금액 (원)
      - `d_program_net_buy`: 프로그램 순매수 금액 (원)
      - `d_institutional_buying_strength`: 기관 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d_foreign_buying_strength`: 외국인 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d_foreign_institutional_buying_strength`: 외국인+기관 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d_individual_buying_strength`: 개인 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d_program_buying_strength`: 프로그램 매수강세 지수 (순매수금액/총거래대금 × 100, %)

  - **트리거 거래량 D+1**
    - **정의**: D 다음 날로, D+1의 거래량과 고가 조건이 모두 충족되어야 D가 유효한 트리거로 확정됨
    - **D+1 거래량 조건**: `d1_volume >= d_volume × 0.5`
    - **D+1 고가 조건**: `d1_high > d_high` (D+1의 고가가 D의 고가보다 높아야 함)
    - **중요**: D+1 조건이 충족되어야 비로소 **D가 정의**됨 (최소 D+1까지 확인 필수)

    - **D+1일 거래량**
      - `d1_volume`: D+1일 거래량
      - `d1_volume_vs_d`: D 거래량 대비 비율 (%)

    - **D+1일 거래대금**
      - `d1_trading_value`: D+1일 거래대금 (억원)

    - **D+1일 가격 데이터**
      - `d1_open`: D+1일 시가
      - `d1_close`: D+1일 종가
      - `d1_high`: D+1일 고가
      - `d1_low`: D+1일 저가
      - `is_d1_high_breakout`: D+1 고가 > D 고가 여부 (Boolean)

    - **D+1일 수급 분석**
      - `d1_institutional_net_buy`: 기관 순매수 금액 (원)
      - `d1_foreign_net_buy`: 외국인 순매수 금액 (원)
      - `d1_foreign_institutional_net_buy`: 외국인+기관 순매수 금액 (원)
      - `d1_individual_net_buy`: 개인 순매수 금액 (원)
      - `d1_program_net_buy`: 프로그램 순매수 금액 (원)
      - `d1_institutional_buying_strength`: 기관 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d1_foreign_buying_strength`: 외국인 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d1_foreign_institutional_buying_strength`: 외국인+기관 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d1_individual_buying_strength`: 개인 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d1_program_buying_strength`: 프로그램 매수강세 지수 (순매수금액/총거래대금 × 100, %)

    - **D+1 검증**
      - `is_d1_qualified`: D+1 조건 충족 여부 (Boolean) - 거래량 + 고가 조건 모두 만족

  - **트리거 거래량 D+2**
    - **정의**: D+1 다음 날로, D+2 조건 충족 시 D, D+2가 확정
    - **D+2 거래량 조건**: `d2_volume >= d_volume × 0.5`
    - **D+2 고가 조건**: `d2_high > d_high` (D+2의 고가가 D의 고가보다 높아야 함)

    - **D+2일 거래량**
      - `d2_volume`: D+2일 거래량
      - `d2_volume_vs_d`: D 거래량 대비 비율 (%)

    - **D+2일 거래대금**
      - `d2_trading_value`: D+2일 거래대금 (억원)

    - **D+2일 가격 데이터**
      - `d2_open`: D+2일 시가
      - `d2_close`: D+2일 종가
      - `d2_high`: D+2일 고가
      - `d2_low`: D+2일 저가
      - `is_d2_high_breakout`: D+2 고가 > D 고가 여부 (Boolean)

    - **D+2일 수급 분석**
      - `d2_institutional_net_buy`: 기관 순매수 금액 (원)
      - `d2_foreign_net_buy`: 외국인 순매수 금액 (원)
      - `d2_foreign_institutional_net_buy`: 외국인+기관 순매수 금액 (원)
      - `d2_individual_net_buy`: 개인 순매수 금액 (원)
      - `d2_program_net_buy`: 프로그램 순매수 금액 (원)
      - `d2_institutional_buying_strength`: 기관 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d2_foreign_buying_strength`: 외국인 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d2_foreign_institutional_buying_strength`: 외국인+기관 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d2_individual_buying_strength`: 개인 매수강세 지수 (순매수금액/총거래대금 × 100, %)
      - `d2_program_buying_strength`: 프로그램 매수강세 지수 (순매수금액/총거래대금 × 100, %)

    - **D+2 검증**
      - `is_d2_qualified`: D+2 조건 충족 여부 (Boolean) - 거래량 + 고가 조건 모두 만족

  - **2번 거래량 블록 확정 조건 (종합)**
    - **필수 조건 1: 1번 블록 거래량 돌파**
      - 2번 블록의 D, D+1, D+2 중 **최소 하나의 거래량**이 1번 거래량 블록 D일 거래량보다 커야 함
      - `max(d_volume, d1_volume, d2_volume) > primary_d_volume`

    - **필수 조건 2: 1번 블록 고가 돌파**
      - 2번 블록의 D, D+1, D+2 중 **최소 하나의 고가**가 1번 거래량 블록 D일 고가보다 커야 함
      - `max(d_high, d1_high, d2_high) > primary_d_high`

    - **필수 조건 3: 거래대금 조건**
      - 2번 블록의 D, D+1, D+2 중 **최소 하나의 거래대금**이 2000억원 이상이어야 함
      - `max(d_trading_value, d1_trading_value, d2_trading_value) >= 2000억원`

    - **필수 조건 4: 패턴 조건**
      - D + D+1 또는 D + D+2, 또는 D + D+1 + D+2 조건을 만족해야 함
      - 패턴 1: D 조건 충족 + D+1 조건 충족
      - 패턴 2: D 조건 충족 + D+2 조건 충족
      - 패턴 3: D 조건 충족 + D+1 조건 충족 + D+2 조건 충족
      - **중요**: 패턴 1, 패턴 2, 패턴 3 중 하나만 만족하면 됨

    - **필수 조건 5: 기간 가격 조건**
      - 2번 거래량 블록의 D 거래량 발생 이후, 추세적으로 1번 거래량 블록의 D일 고가 위에서 14일 이상 종가를 형성하는 기간이 존재

    - **최종 확정**
      - 위 5가지 필수 조건을 **모두 만족**하면 2번 거래량 블록 확정

---

#### 2.1.2 거래량 블록 범위 정의 (Block Range Definition)

---

### 1번 거래량 블록 범위

**정의:**
```
블록 시작: 1번 거래량 D일
블록 종료: 2번 거래량 D일 발생 직전일
블록 기간: 1번 D일 ~ 2번 D일 전날
```

**목적:**
- 1번 블록 발생 후 2번 블록 발생까지의 중간 기간 분석
- 이 기간 동안의 주가/거래량 움직임이 2번 블록의 성공 여부에 영향을 줄 수 있음

**데이터 구조:**
```python
# 1번 거래량 블록 정보
block_1 = {
    "block_type": "primary",             # 블록 타입 (primary)
    "is_primary_confirmed": True,        # 1번 블록 확정 여부

    # ========== D일 정보 ==========
    "d_date": "2019-03-15",              # D일 날짜

    # D일 거래량 정보
    "d_volume": 35000000,                # D일 거래량
    "is_2y_max": True,                   # 2년래 최대 거래량 여부
    "max_2y_volume": 35000000,           # 2년 내 최고 거래량

    # D일 거래대금
    "d_trading_value": 2000,             # D일 거래대금 (억원)
    "is_500b_value": True,               # 500억원 이상 여부
    "trading_value_score": 10,           # 거래대금 점수 (10점 만점)

    # D일 가격 데이터
    "d_open": 46500,                     # D일 시가
    "d_close": 47000,                    # D일 종가
    "d_high": 48000,                     # D일 고가
    "d_low": 46000,                      # D일 저가

    # D일 신고가 분석
    "is_new_high_2y": True,              # 2년래 신고가 여부
    "max_2y": 48000,                     # 2년 내 최고가

    # D일 수급 데이터
    "d_institutional_net_buy": 5000000000,        # 기관 순매수 금액 (원)
    "d_foreign_net_buy": 8000000000,              # 외국인 순매수 금액 (원)
    "d_foreign_institutional_net_buy": 13000000000,  # 외국인+기관 순매수 (원)
    "d_individual_net_buy": -13000000000,         # 개인 순매수 금액 (원)
    "d_program_net_buy": 2000000000,              # 프로그램 순매수 금액 (원)
    "d_institutional_buying_strength": 2.5,       # 기관 매수강세 지수 (%)
    "d_foreign_buying_strength": 4.0,             # 외국인 매수강세 지수 (%)
    "d_foreign_institutional_buying_strength": 6.5,  # 외국인+기관 매수강세 지수 (%)
    "d_individual_buying_strength": -6.5,         # 개인 매수강세 지수 (%)
    "d_program_buying_strength": 1.0,             # 프로그램 매수강세 지수 (%)

    # ========== 블록 기간 정보 (D일 ~ 2번 블록 D일 전날) ==========
    "range_start_date": "2019-03-15",    # 블록 기간 시작 (D일)
    "range_end_date": "2019-08-19",      # 블록 기간 종료 (2번 블록 D일 전날)
    "range_duration_days": 157,          # 블록 기간

    # 블록 기간 가격 정보
    "range_high": 48000,                 # 블록 기간 중 최고가
    "range_high_date": "2019-05-20",     # 최고가 달성일
    "range_low": 42000,                  # 블록 기간 중 최저가
    "range_low_date": "2019-07-10",      # 최저가 발생일

    # 블록 기간 거래량 정보
    "range_avg_volume": 500000,          # 블록 기간 평균 일 거래량

    # 블록 기간 지수 대비 성과
    "market_index": "KOSPI",             # 비교 지수 (KOSPI/KOSDAQ)
    "range_return": 2.13,                # 블록 기간 종목 수익률 (%, range_end 종가 기준)
    "index_return": -1.5,                # 블록 기간 지수 수익률 (%)
    "relative_return": 3.63,             # 상대 수익률 (종목 - 지수, %p)
    "beta": 1.25,                        # 베타 (시장 대비 민감도, 기간 내 일별 수익률 회귀)
    "alpha": 4.5,                        # 알파 (초과 수익률, %)
    "outperformance": True,              # 시장 대비 초과 성과 여부
    "max_return_vs_index": 8.5,          # 최대 수익률 시점의 지수 대비 초과 수익률 (%p, range_high 기준)

    # 2번 블록 관계 정보
    "days_to_block2": 157,               # 1번 블록 → 2번 블록까지 소요일
    "is_within_6months": True            # 6개월 내 2번 블록 발생 여부
}
```

**주요 변수:**
- `d_date`: 1번 블록 D일
- `range_start_date`: 블록 기간 시작 (D일)
- `range_end_date`: 블록 기간 종료 (2번 블록 D일 전날)
- `range_high`: 1번~2번 블록 사이 기간 중 최고가
- `days_to_block2`: 1번 블록 발생 후 2번 블록까지 소요일 (최대 6개월 = 180일)

**시각화 예시:**

```
주가 차트:
                  ↗ 최고가 48,000원 (5/20)
                ↗   ↘
              ↗       ↘
            ↗           ↘
D일 (3/15)                ↘
    ↑                       ↘
블록 시작                     └─ 2번 블록 직전 (8/19)
|←──── 블록 기간 157일 ────→|      ↑
                                블록 종료

거래량:
D일 (3/15): ████████████ (1번 거래량 발생, 2년래 최대)
3/20:       ██████
4/1:        ████
5/1:        ███
5/20:       ████ (최고가 달성일)
6/1:        ███
7/1:        ██
8/1:        ██
8/19:       █ (2번 블록 발생 직전)
```

---

### 2번 거래량 블록 범위

> **핵심 개념**: 2번 거래량 블록을 단순히 D, D+1, D+2 3일이 아닌, **D일부터 주가가 60일 이동평균선으로 회귀할 때까지의 전체 기간**을 하나의 블록으로 정의

**배경:**
- 실제 차트에서 2번 거래량 D일 발생 이후, 수일~수주간 지속적인 거래량 증가 및 주가 상승 추세가 나타남
- 이 추세가 끝나는 시점을 명확히 정의해야 **블록 기간 중 최고가**를 수익률 계산 기준점으로 사용 가능

**블록 종료 조건: 60일 이동평균선 회귀**

**정의:**
```
블록 시작: D일 (2번 거래량 발생일)
블록 종료: 주가가 60일 이동평균선을 터치하거나 하방 이탈하는 첫 시점
블록 기준가: 블록 기간(D일 ~ 블록 종료일) 중 최고가
```

**알고리즘:**


**데이터 구조:**

```python
# 2번 거래량 블록 정보
block_2 = {
    "block_type": "secondary",           # 블록 타입 (secondary)
    "is_secondary_confirmed": True,      # 2번 블록 확정 여부

    # ========== D일 정보 ==========
    "d_date": "2019-08-20",              # D일 날짜

    # D일 거래량
    "d_volume": 80000000,                # D일 거래량
    "d_volume_vs_primary": 2.29,         # 1번 블록 D일 거래량 대비 비율 (229%)
    "is_80pct_of_primary": True,         # 1번 블록 대비 80% 이상 여부
    "days_from_primary": 157,            # 1번 블록으로부터 경과 일수
    "is_within_6months": True,           # 6개월 내 발생 여부

    # D일 거래대금
    "d_trading_value": 4000,             # D일 거래대금 (억원)
    "is_500b_value": True,               # 500억원 이상 여부
    "trading_value_score": 10,           # 거래대금 점수 (10점 만점)

    # D일 가격 데이터
    "d_open": 49500,                     # D일 시가
    "d_close": 50000,                    # D일 종가
    "d_high": 51000,                     # D일 고가
    "d_low": 49000,                      # D일 저가

    # D일 수급 데이터
    "d_institutional_net_buy": 12000000000,       # 기관 순매수 (원)
    "d_foreign_net_buy": 15000000000,             # 외국인 순매수 (원)
    "d_foreign_institutional_net_buy": 27000000000,  # 외국인+기관 순매수 (원)
    "d_individual_net_buy": -27000000000,         # 개인 순매수 (원)
    "d_program_net_buy": 3000000000,              # 프로그램 순매수 (원)
    "d_institutional_buying_strength": 3.0,       # 기관 매수강세 지수 (%)
    "d_foreign_buying_strength": 3.75,            # 외국인 매수강세 지수 (%)
    "d_foreign_institutional_buying_strength": 6.75,  # 외국인+기관 매수강세 지수 (%)
    "d_individual_buying_strength": -6.75,        # 개인 매수강세 지수 (%)
    "d_program_buying_strength": 0.75,            # 프로그램 매수강세 지수 (%)

    # ========== D+1일 정보 ==========
    "d1_date": "2019-08-21",             # D+1일 날짜

    # D+1일 거래량
    "d1_volume": 60000000,               # D+1일 거래량
    "d1_volume_vs_d": 0.75,              # D일 거래량 대비 비율 (75%)

    # D+1일 거래대금
    "d1_trading_value": 3200,            # D+1일 거래대금 (억원)

    # D+1일 가격 데이터
    "d1_open": 50500,                    # D+1일 시가
    "d1_close": 51500,                   # D+1일 종가
    "d1_high": 52000,                    # D+1일 고가
    "d1_low": 50000,                     # D+1일 저가
    "is_d1_high_breakout": True,         # D+1 고가 > D 고가 여부

    # D+1일 수급 데이터
    "d1_institutional_net_buy": 8000000000,       # 기관 순매수 (원)
    "d1_foreign_net_buy": 10000000000,            # 외국인 순매수 (원)
    "d1_foreign_institutional_net_buy": 18000000000,  # 외국인+기관 순매수 (원)
    "d1_individual_net_buy": -18000000000,        # 개인 순매수 (원)
    "d1_program_net_buy": 2500000000,             # 프로그램 순매수 (원)
    "d1_institutional_buying_strength": 2.5,      # 기관 매수강세 지수 (%)
    "d1_foreign_buying_strength": 3.1,            # 외국인 매수강세 지수 (%)
    "d1_foreign_institutional_buying_strength": 5.6,  # 외국인+기관 매수강세 지수 (%)
    "d1_individual_buying_strength": -5.6,        # 개인 매수강세 지수 (%)
    "d1_program_buying_strength": 0.8,            # 프로그램 매수강세 지수 (%)

    # D+1 검증
    "is_d1_qualified": True,             # D+1 조건 충족 여부

    # ========== D+2일 정보 ==========
    "d2_date": "2019-08-22",             # D+2일 날짜

    # D+2일 거래량
    "d2_volume": 45000000,               # D+2일 거래량
    "d2_volume_vs_d": 0.56,              # D일 거래량 대비 비율 (56%)

    # D+2일 거래대금
    "d2_trading_value": 2400,            # D+2일 거래대금 (억원)

    # D+2일 가격 데이터
    "d2_open": 51000,                    # D+2일 시가
    "d2_close": 51200,                   # D+2일 종가
    "d2_high": 51800,                    # D+2일 고가
    "d2_low": 50500,                     # D+2일 저가
    "is_d2_high_breakout": True,         # D+2 고가 > D 고가 여부

    # D+2일 수급 데이터
    "d2_institutional_net_buy": 3000000000,       # 기관 순매수 (원)
    "d2_foreign_net_buy": 5000000000,             # 외국인 순매수 (원)
    "d2_foreign_institutional_net_buy": 8000000000,   # 외국인+기관 순매수 (원)
    "d2_individual_net_buy": -8000000000,         # 개인 순매수 (원)
    "d2_program_net_buy": 1500000000,             # 프로그램 순매수 (원)
    "d2_institutional_buying_strength": 1.5,      # 기관 매수강세 지수 (%)
    "d2_foreign_buying_strength": 2.5,            # 외국인 매수강세 지수 (%)
    "d2_foreign_institutional_buying_strength": 4.0,  # 외국인+기관 매수강세 지수 (%)
    "d2_individual_buying_strength": -4.0,        # 개인 매수강세 지수 (%)
    "d2_program_buying_strength": 0.75,           # 프로그램 매수강세 지수 (%)

    # D+2 검증
    "is_d2_qualified": True,             # D+2 조건 충족 여부

    # ========== 패턴 만족 여부 ==========
    "is_d_plus_d1_pattern": True,        # D + D+1 패턴 만족 여부
    "is_d_plus_d2_pattern": False,       # D + D+2 패턴 만족 여부
    "is_d_plus_d1_d2_pattern": False,    # D + D+1 + D+2 모두 만족 여부
    "matched_pattern": "D+D+1",          # 만족한 패턴

    # ========== 블록 기간 정보 (D일 ~ 60이평선 회귀일) ==========
    "range_start_date": "2019-08-20",    # 블록 기간 시작 (D일)
    "range_end_date": "2019-10-15",      # 블록 기간 종료 (60이평선 회귀일)
    "range_duration_days": 56,           # 블록 기간

    # 블록 기간 가격 정보
    "range_high": 52000,                 # ★ 수익률 계산 기준점 (블록 기간 중 최고가)
    "range_high_date": "2019-09-10",     # 최고가 달성일
    "range_low": 48000,                  # 블록 기간 중 최저가
    "range_low_date": "2019-09-05",      # 최저가 발생일

    # 블록 종료일 가격 데이터
    "range_end_open": 46500,             # 블록 종료일 시가
    "range_end_high": 47000,             # 블록 종료일 고가
    "range_end_low": 45500,              # 블록 종료일 저가
    "range_end_close": 46000,            # 블록 종료일 종가

    # 60이평선 정보
    "ma60_at_start": 45000,              # 블록 시작일 60이평선
    "ma60_at_end": 46500,                # 블록 종료일 60이평선
    "range_end_reason": "터치",           # 종료 사유: "터치" or "하방이탈"

    # 블록 기간 거래량 정보
    "range_avg_volume": 1428571,         # 블록 기간 평균 일 거래량
    "range_peak_volume_date": "2019-08-20",  # 최대 거래량 발생일 (D일)

    # 블록 기간 지수 대비 성과
    "market_index": "KOSPI",             # 비교 지수 (KOSPI/KOSDAQ)
    "range_return": -8.0,                # 블록 기간 종목 수익률 (%, range_end 종가 기준)
    "index_return": 2.5,                 # 블록 기간 지수 수익률 (%)
    "relative_return": -10.5,            # 상대 수익률 (종목 - 지수, %p)
    "beta": 1.42,                        # 베타 (시장 대비 민감도, 기간 내 일별 수익률 회귀)
    "alpha": -12.5,                      # 알파 (초과 수익률, %)
    "outperformance": False,             # 시장 대비 초과 성과 여부
    "max_return_vs_index": 2.3,          # 최대 수익률 시점의 지수 대비 초과 수익률 (%p, range_high 기준)
}
```

---

### 3번 거래량 블록 (추가 거래량 블록)

> **핵심 개념**: 2번 거래량 블록 이후 추가적인 대량 거래가 발생하며, 외국인+기관 쌍끌이 매수가 나타나는 시점

**정의:**
- 2번 거래량 블록 발생 이후 6개월 내 발생하는 추가 거래량 블록
- 외국인+기관 쌍끌이 매수 패턴 확인

**3번 거래량 블록 발생 조건:**
- **필수 조건 1: 거래량 조건**
  - 해당일 거래량 ≥ 2번 블록 최대 거래량 × 15%
  - `volume >= max(block_2.d_volume, block_2.d1_volume, block_2.d2_volume) × 0.15`

- **필수 조건 2: 가격 조건**
  - 해당일 고가가 2번 블록 최고가 대비 ±12% 이내
  - `abs((high - block_2_range.block_high) / block_2_range.block_high × 100) <= 12`

- **최종 확정**
  - 위 2가지 필수 조건을 **모두 만족**하면 3번 거래량 블록 발생

**3번 거래량 블록 품질 평가 (10점 만점):**
- **기본 점수: 5점** (필수 조건 통과)

- **보너스 점수:**
  - +5점: 외국인+기관 쌍끌이 발생 (`institutional_net_buy > 0 AND foreign_net_buy > 0`)
  - +3점: 외국인 또는 기관 단독 순매수
  - +2점: 외국인+기관 매수강세 지수 합계 > 5% (`institutional_buying_strength + foreign_buying_strength > 5`)
  - +1점: 프로그램 순매수 동반 (`program_net_buy > 0`)

- **품질 등급:**
  - S등급 (10점): 완벽한 쌍끌이 + 강한 매수강세
  - A등급 (8-9점): 쌍끌이 발생
  - B등급 (6-7점): 단독 순매수
  - C등급 (5점): 수급 지원 없음

**목적:**
- 2번 블록 이후 **추가 자금 유입** 확인
- **외국인+기관 쌍끌이** 수급이 성공의 핵심 팩터인지 검증
- 수급 강도(거래대금 대비 매수 비율)와 성공률의 상관관계 분석

**알고리즘:**


**데이터 구조:**
```python
block_3 = {
    "block_type": "additional_1",            # 블록 타입 (additional_1)
    "has_block_3": True,                     # 3번 블록 발생 여부

    # ========== D일 정보 ==========
    "d_date": "2019-09-25",                  # 3번 블록 발생일
    "days_from_block_2": 36,                 # 2번 블록 D일로부터 일수

    # D일 거래량 정보
    "d_volume": 15000000,                    # 3번 블록 거래량
    "block_2_max_volume": 80000000,          # 2번 블록 최대 거래량 (비교 기준)
    "d_volume_ratio_vs_block2": 0.1875,      # 2번 블록 대비 거래량 비율 (18.75%)
    "is_volume_condition_met": True,         # 거래량 조건 만족 (15% 이상)

    # D일 거래대금
    "d_trading_value": 850,                  # D일 거래대금 (억원)

    # D일 가격 데이터
    "d_open": 50000,                         # 시가
    "d_high": 52500,                         # 고가
    "d_low": 49500,                          # 저가
    "d_close": 51500,                        # 종가

    "block_2_high": 52000,                   # 2번 블록 최고가 (비교 기준)
    "d_price_diff_from_block2": 500,         # 2번 블록 최고가 대비 차이 (원)
    "d_price_diff_pct": 0.96,                # 2번 블록 최고가 대비 차이 (%)
    "is_price_condition_met": True,          # 가격 조건 만족 (±12% 이내)

    # D일 수급 데이터
    "d_institutional_net_buy": 8500000000,   # 기관 순매수 금액 (원)
    "d_foreign_net_buy": 12000000000,        # 외국인 순매수 금액 (원)
    "d_foreign_institutional_net_buy": 20500000000,  # 외국인+기관 순매수 (원)
    "d_individual_net_buy": -20500000000,    # 개인 순매수 금액 (원)
    "d_program_net_buy": 1500000000,         # 프로그램 순매수 금액 (원)

    "d_institutional_buying_strength": 1.0,  # 기관 매수강세 지수 (%)
    "d_foreign_buying_strength": 1.41,       # 외국인 매수강세 지수 (%)
    "d_foreign_institutional_buying_strength": 2.41,  # 외국인+기관 매수강세 지수 (%)
    "d_individual_buying_strength": -2.41,   # 개인 매수강세 지수 (%)
    "d_program_buying_strength": 0.18,       # 프로그램 매수강세 지수 (%)

    "is_both_buying": True,                  # 쌍끌이 여부 (외국인+기관 모두 순매수)

    # ========== 품질 평가 ==========
    "quality_score": 10,                     # 품질 점수 (10점 만점)
    "quality_grade": "S",                    # 품질 등급 (S/A/B/C)

    # ========== 블록 기간 정보 (D일 이후 추적) ==========
    "range_start_date": "2019-09-25",        # 블록 기간 시작 (D일)
    "range_end_date": "2019-11-20",          # 블록 기간 종료 (분석 시점 또는 다음 블록 발생)
    "range_duration_days": 56,               # 블록 기간

    # 블록 기간 가격 정보
    "range_high": 54000,                     # 블록 기간 중 최고가
    "range_high_date": "2019-10-15",         # 최고가 달성일
    "range_low": 49000,                      # 블록 기간 중 최저가
    "range_low_date": "2019-10-01",          # 최저가 발생일

    # 블록 기간 거래량 정보
    "range_avg_volume": 800000,              # 블록 기간 평균 일 거래량

    # 블록 기간 지수 대비 성과
    "market_index": "KOSPI",                 # 비교 지수 (KOSPI/KOSDAQ)
    "range_return": 3.5,                     # 블록 기간 종목 수익률 (%, range_end 종가 기준)
    "index_return": 1.8,                     # 블록 기간 지수 수익률 (%)
    "relative_return": 1.7,                  # 상대 수익률 (종목 - 지수, %p)
    "beta": 1.38,                            # 베타 (시장 대비 민감도, 기간 내 일별 수익률 회귀)
    "alpha": 1.2,                            # 알파 (초과 수익률, %)
    "outperformance": True,                  # 시장 대비 초과 성과 여부
    "max_return_vs_index": 5.8,              # 최대 수익률 시점의 지수 대비 초과 수익률 (%p, range_high 기준)
}
```

**수급 강도 등급 기준:**


---

### 4번 거래량 블록 (추가 거래량 블록 2차)

**정의:**
- 3번 거래량 블록 이후 발생하는 2차 추가 거래량 블록
- 반복적인 자금 유입 패턴 확인

**4번 거래량 블록 발생 조건:**
- **필수 조건 1: 거래량 조건**
  - 해당일 거래량 ≥ 2번 블록 최대 거래량 × 15%
  - `volume >= max(block_2.d_volume, block_2.d1_volume, block_2.d2_volume) × 0.15`

- **필수 조건 2: 가격 조건**
  - 해당일 고가가 2번 블록 최고가 대비 ±12% 이내
  - `abs((high - block_2_range.block_high) / block_2_range.block_high × 100) <= 12`

- **최종 확정**
  - 위 2가지 필수 조건을 **모두 만족**하면 4번 거래량 블록 발생

**4번 거래량 블록 품질 평가 (10점 만점):**
- **기본 점수: 5점** (필수 조건 통과)

- **보너스 점수:**
  - +5점: 외국인+기관 쌍끌이 발생 (`institutional_net_buy > 0 AND foreign_net_buy > 0`)
  - +3점: 외국인 또는 기관 단독 순매수
  - +2점: 외국인+기관 매수강세 지수 합계 > 5% (`institutional_buying_strength + foreign_buying_strength > 5`)
  - +1점: 프로그램 순매수 동반 (`program_net_buy > 0`)

- **품질 등급:**
  - S등급 (10점): 완벽한 쌍끌이 + 강한 매수강세
  - A등급 (8-9점): 쌍끌이 발생
  - B등급 (6-7점): 단독 순매수
  - C등급 (5점): 수급 지원 없음

**목적:**
- **반복적인 자금 유입** 패턴 확인
- 3번 블록 → 4번 블록 연속 발생 시 성공률이 더 높은지 검증
- 수급 강도의 지속성과 Level 상승의 관계 분석

**데이터 구조:**
```python
block_4 = {
    "block_type": "additional_2",            # 블록 타입 (additional_2)
    "has_block_4": True,                     # 4번 블록 발생 여부

    # ========== D일 정보 ==========
    "d_date": "2019-10-18",                  # 4번 블록 발생일
    "days_from_block_2": 59,                 # 2번 블록 D일로부터 일수
    "days_from_block_3": 23,                 # 3번 블록으로부터 일수

    # D일 거래량 정보
    "d_volume": 18000000,                    # 4번 블록 거래량
    "block_2_max_volume": 80000000,          # 2번 블록 최대 거래량 (비교 기준)
    "d_volume_ratio_vs_block2": 0.225,       # 2번 블록 대비 거래량 비율 (22.5%)
    "is_volume_condition_met": True,         # 거래량 조건 만족 (15% 이상)

    # D일 거래대금
    "d_trading_value": 920,                  # D일 거래대금 (억원)

    # D일 가격 데이터
    "d_open": 51000,                         # 시가
    "d_high": 53000,                         # 고가
    "d_low": 50500,                          # 저가
    "d_close": 52500,                        # 종가

    "block_2_high": 52000,                   # 2번 블록 최고가 (비교 기준)
    "d_price_diff_from_block2": 1000,        # 2번 블록 최고가 대비 차이 (원)
    "d_price_diff_pct": 1.92,                # 2번 블록 최고가 대비 차이 (%)
    "is_price_condition_met": True,          # 가격 조건 만족 (±12% 이내)

    # D일 수급 데이터
    "d_institutional_net_buy": 10000000000,  # 기관 순매수 금액 (원)
    "d_foreign_net_buy": 15000000000,        # 외국인 순매수 금액 (원)
    "d_foreign_institutional_net_buy": 25000000000,  # 외국인+기관 순매수 (원)
    "d_individual_net_buy": -25000000000,    # 개인 순매수 금액 (원)
    "d_program_net_buy": 2000000000,         # 프로그램 순매수 금액 (원)

    "d_institutional_buying_strength": 1.09, # 기관 매수강세 지수 (%)
    "d_foreign_buying_strength": 1.63,       # 외국인 매수강세 지수 (%)
    "d_foreign_institutional_buying_strength": 2.72,  # 외국인+기관 매수강세 지수 (%)
    "d_individual_buying_strength": -2.72,   # 개인 매수강세 지수 (%)
    "d_program_buying_strength": 0.22,       # 프로그램 매수강세 지수 (%)

    "is_both_buying": True,                  # 쌍끌이 여부

    # ========== 품질 평가 ==========
    "quality_score": 10,                     # 품질 점수 (10점 만점)
    "quality_grade": "S",                    # 품질 등급 (S/A/B/C)

    # ========== 블록 기간 정보 (D일 이후 추적) ==========
    "range_start_date": "2019-10-18",        # 블록 기간 시작 (D일)
    "range_end_date": "2020-01-15",          # 블록 기간 종료 (분석 시점 또는 다음 블록 발생)
    "range_duration_days": 89,               # 블록 기간

    # 블록 기간 가격 정보
    "range_high": 58000,                     # 블록 기간 중 최고가
    "range_high_date": "2019-12-20",         # 최고가 달성일
    "range_low": 50000,                      # 블록 기간 중 최저가
    "range_low_date": "2019-11-05",          # 최저가 발생일

    # 블록 기간 거래량 정보
    "range_avg_volume": 900000,              # 블록 기간 평균 일 거래량

    # 블록 기간 지수 대비 성과
    "market_index": "KOSPI",                 # 비교 지수 (KOSPI/KOSDAQ)
    "range_return": 8.5,                     # 블록 기간 종목 수익률 (%, range_end 종가 기준)
    "index_return": 4.2,                     # 블록 기간 지수 수익률 (%)
    "relative_return": 4.3,                  # 상대 수익률 (종목 - 지수, %p)
    "beta": 1.28,                            # 베타 (시장 대비 민감도, 기간 내 일별 수익률 회귀)
    "alpha": 3.1,                            # 알파 (초과 수익률, %)
    "outperformance": True,                  # 시장 대비 초과 성과 여부
    "max_return_vs_index": 9.5,              # 최대 수익률 시점의 지수 대비 초과 수익률 (%p, range_high 기준)
}
```

---

### 3번/4번 블록 패턴 분석

**데이터 구조:**
```python
additional_blocks_pattern = {
    # 블록 발생 현황
    "has_block_3": True,
    "has_block_4": True,
    "total_additional_blocks": 2,            # 3번, 4번 블록 개수

    # 블록 간격 분석
    "block_2_to_3_days": 36,                 # 2번 → 3번 간격
    "block_3_to_4_days": 23,                 # 3번 → 4번 간격
    "is_frequent_blocks": True,              # 빈번한 블록 발생 (간격 30일 이하)

    # 수급 패턴 분석
    "block_3_supply_grade": "B",             # 3번 블록 수급 강도
    "block_4_supply_grade": "B",             # 4번 블록 수급 강도
    "is_consistent_supply": True,            # 지속적 강한 수급 (B등급 이상)

    # 수급 강도 추세
    "supply_trend": "유지",                   # 상승/유지/하락
    "avg_supply_score": 7.65,                # 3번, 4번 평균 수급 점수

    # 패턴 종합
    "pattern_type": "연속 쌍끌이",            # "연속 쌍끌이" / "단발 쌍끌이" / "없음"
    "pattern_strength": "강",                 # 강/중/약
}
```

**수익률 계산:**


**시각화 예시:**
```
주가 차트:
                  ↗ 최고가 52,000원 (9/10)
                ↗   ↘
              ↗       ↘
            ↗           ↘
          ↗               ↘ ← 60이평선 터치 (10/15)
D일 (8/20)                 └─ 블록 종료
    ↑                         ↑
블록 시작                  블록 종료
|←──── 블록 기간 56일 ────→|

거래량:
D일 (8/20): ████████████ (2번 거래량 발생)
8/25:       ██████
9/1:        ████
9/10:       ███ (최고가 달성일)
9/20:       ██
10/1:       ██
10/15:      █ (평상시 수준 + 60이평선 터치)
```

**주요 변수:**
- `block_start_date`: D일
- `block_end_date`: 60이평선 터치/하방이탈일
- `block_high`: 블록 기간 중 최고가 (**수익률 계산 기준점**)
- `block_duration_days`: 블록 지속 기간

---

#### 2.1.3 2번 거래량 블록 최고가 신고가 여부 분석

> **핵심 개념**: 2번 거래량 블록의 최고가(`block_2_range.block_high`)가 과거 대비 얼마나 의미있는 고점인지 판단 (신고가 = 강한 모멘텀)

**배경:**
- 블록 최고가가 **역사적 신고가** 또는 **장기 신고가**일 경우 → 강한 상승 모멘텀, 고수익 가능성 높음
- 블록 최고가가 과거 고점 대비 낮은 수준일 경우 → 약한 반등, 저수익 가능성

**신고가 판단 기준:**



**신고가 등급 시스템:**

| 등급 | 조건 | 점수 | 의미 | 예상 수익률 구간 |
|------|------|------|------|------------------|
| S등급 | 역사적 신고가 | 10점 | 최강 모멘텀 | Level 3~4 (300%+) |
| A등급 | 10년래 신고가 | 8점 | 강한 모멘텀 | Level 2~3 (100~300%) |
| B등급 | 5년래 신고가 | 6점 | 중강 모멘텀 | Level 2 (100~300%) |
| C등급 | 2년래 신고가 | 4점 | 보통 모멘텀 | Level 1~2 (50~100%) |
| D등급 | ATH의 90% 이상 | 3점 | 약한 모멘텀 | Level 1 (50~100%) |
| E등급 | ATH의 70~90% | 2점 | 약한 반등 | Level 0~1 (<50%) |
| F등급 | ATH의 70% 미만 | 1점 | 매우 약한 반등 | Level 0 (실패 가능성) |

**분석 예시:**



**비지도 학습 활용:**

```python
# 3.6 비지도 학습에서 팩터로 활용
features = {
    # ... 기존 팩터들 ...
    "new_high_score": 4,
    "is_all_time_high": False,
    "ratio_to_ath": 61.2,
    # ...
}

# 분석 예상 결과:
# Level 4 달성 케이스:
#   - new_high_score 평균: 8.5 (대부분 10년래 또는 역사적 신고가)
#   - is_all_time_high: 70%
#
# Level 1 달성 케이스:
#   - new_high_score 평균: 3.2
#   - is_all_time_high: 10%
```

**시각화:**

```
역사적 차트 (10년):

85,000 ─────────────── ATH (2015년)
        |
        ↓ 5년 하락
        |
68,000 ─── 5년래 최고가 (2017년)

        ... 조정 ...

52,000 ─── ★ 블록 최고가 (2019년) ← 2년래 신고가
           ratio_to_ath = 61.2%
           new_high_score = 4점 (C등급)

45,000 ─── 120이평선
```

**중요도:**
- **신고가 여부**는 수익률 Level 예측에 **매우 중요한 팩터**
- 비지도 학습(3.6.3)에서 **팩터 중요도 분석** 시 상위권 예상
- 지도 학습(3.7)에서 **성공 패턴 템플릿**에도 신고가 여부 포함

---

## 2.2 재무제표 트렌드 분석

> **분석 기준 기간**: 1번 거래량 블록 D일부터 분석 현재 시점까지 지속적으로 모니터링
>
> **★ 중요**: 1번 거래량 블록 발생 시점부터 재무제표 데이터를 지속적으로 추적하여 실적 개선/악화 여부를 모니터링

### 2.2.1 영업이익 트렌드

**실적 턴어라운드**
- 적자→흑자 전환 시점 포착
- 영업이익률 개선 추세
- 분기별/연도별 실적 증가율

**이익 지속성**
- 영업이익 연속 증가 분기 수
- 이익 안정성 및 변동성
- 컨센서스 대비 실적 서프라이즈

**수익성 지표**
- ROE, ROA 추이
- 영업이익률, 순이익률 변화
- 매출액 증가율 vs 이익 증가율

**데이터 구조:**
```python
operating_profit_analysis = {
    # 분석 기간
    "analysis_start_date": "2019-03-15",  # 1번 블록 D일 (모니터링 시작)
    "primary_block_date": "2019-03-15",   # 1번 블록 D일
    "secondary_block_date": "2019-08-20", # 2번 블록 D일
    "current_date": "2020-03-15",         # 분석 현재 시점
    "total_analysis_quarters": 4,         # 총 분석 분기 수 (1번 블록 ~ 현재)

    # 실적 턴어라운드
    "turnaround": {
        "has_turnaround": True,               # 턴어라운드 여부
        "turnaround_date": "2018-Q3",         # 흑자 전환 시점
        "quarters_since_turnaround": 3,       # 흑자 전환 후 경과 분기
        "operating_margin_improvement": 8.5,  # 영업이익률 개선폭 (%)
        "yoy_growth_rate": 125.5,             # 전년 동기 대비 성장률 (%)
        "qoq_growth_rate": 35.2,              # 전분기 대비 성장률 (%)
    },

    # 이익 지속성
    "profit_sustainability": {
        "consecutive_profit_quarters": 3,     # 연속 흑자 분기 수
        "consecutive_growth_quarters": 3,     # 연속 증가 분기 수
        "profit_volatility": 15.2,            # 이익 변동성 (표준편차 %)
        "stability_score": 7.8,               # 안정성 점수 (10점 만점)
        "consensus_surprise": 25.5,           # 컨센서스 대비 실적 서프라이즈 (%)
        "surprise_direction": "상향",          # 서프라이즈 방향
    },

    # 수익성 지표
    "profitability": {
        "roe_current": 15.2,                  # 현재 ROE (%)
        "roe_2y_ago": 5.5,                    # 2년 전 ROE (%)
        "roe_improvement": 9.7,               # ROE 개선폭 (%)

        "roa_current": 8.5,                   # 현재 ROA (%)
        "roa_2y_ago": 2.8,                    # 2년 전 ROA (%)
        "roa_improvement": 5.7,               # ROA 개선폭 (%)

        "operating_margin_current": 12.5,     # 현재 영업이익률 (%)
        "operating_margin_2y_ago": 4.0,       # 2년 전 영업이익률 (%)

        "net_margin_current": 9.2,            # 현재 순이익률 (%)
        "net_margin_2y_ago": 1.5,             # 2년 전 순이익률 (%)

        "revenue_growth_rate": 45.5,          # 매출 증가율 (%)
        "profit_growth_rate": 125.5,          # 이익 증가율 (%)
        "profit_leverage": 2.76,              # 이익 레버리지 (이익증가율/매출증가율)
    }
}
```

### 2.2.2 자본 총계 트렌드

**자본 총계 증가율**
- 분기별/연도별 자본 총계 변화
- 자본 총계 연속 증가 추이
- 자본 총계 증가 지속성

**자본 구조 분석**
- 자본금 변화
- 이익잉여금 누적 추이
- 부채비율 vs 자본 총계 관계

**데이터 구조:**
```python
equity_analysis = {
    # 분석 기간
    "analysis_start_date": "2019-03-15",  # 1번 블록 D일 (모니터링 시작)
    "primary_block_date": "2019-03-15",   # 1번 블록 D일
    "secondary_block_date": "2019-08-20", # 2번 블록 D일
    "current_date": "2020-03-15",         # 분석 현재 시점
    "total_analysis_quarters": 4,         # 총 분석 분기 수 (1번 블록 ~ 현재)

    # 자본 총계 증가율
    "equity_growth": {
        "total_equity_current": 500000000000,     # 현재 자본 총계 (원)
        "total_equity_2y_ago": 350000000000,      # 2년 전 자본 총계 (원)
        "equity_growth_amount": 150000000000,     # 자본 총계 증가액 (원)
        "equity_growth_rate": 42.9,               # 자본 총계 증가율 (%)
        "consecutive_growth_quarters": 7,         # 연속 증가 분기 수
        "avg_quarterly_growth_rate": 4.8,         # 평균 분기 증가율 (%)
        "growth_sustainability": "매우 강함",      # 증가 지속성
    },

    # 자본 구조 분석
    "capital_structure": {
        "paid_in_capital_current": 100000000000,  # 현재 자본금 (원)
        "paid_in_capital_2y_ago": 100000000000,   # 2년 전 자본금 (원)
        "capital_increase": False,                # 유상증자 여부

        "retained_earnings_current": 350000000000,  # 현재 이익잉여금 (원)
        "retained_earnings_2y_ago": 200000000000,   # 2년 전 이익잉여금 (원)
        "retained_earnings_growth": 150000000000,   # 이익잉여금 증가액 (원)
        "retained_earnings_growth_rate": 75.0,      # 이익잉여금 증가율 (%)

        "debt_ratio_current": 85.5,               # 현재 부채비율 (%)
        "debt_ratio_2y_ago": 125.5,               # 2년 전 부채비율 (%)
        "debt_ratio_improvement": -40.0,          # 부채비율 개선폭 (%)

        "structure_score": 8.5,                   # 자본 구조 점수 (10점 만점)
        "interpretation": "자본 총계 강한 증가 + 부채비율 개선 → 재무 건전성 향상"
    }
}
```

---

## 2.3 수급 분석

> **분석 기준 기간**: 2번 거래량 블록 D일부터 분석 현재 시점까지 지속적으로 분석

> **★ 중요**: 이 섹션은 **기간 트렌드 분석**입니다.
> - 1번/2번 블록의 D, D+1, D+2 수급 데이터 = **당일 스냅샷** (그날 순매수/순매도 여부)
> - 2.3 수급 분석 = **기간 추세** (연속 매수일, 총 매수금액, 보유비중 변화 등)

### 2.3.1 시장 참여자 동향

**공매도 분석**
- 공매도 거래량 및 비중
- 공매도 잔고 변화 추이
- 공매도 증가/감소 패턴

**프로그램 매매**
- 프로그램 순매수/순매도
- 차익거래/비차익거래 구분
- 프로그램 매매 비중

**데이터 구조:**
```python
market_participant_analysis = {
    # 분석 기간
    "analysis_start_date": "2019-08-20",  # 2번 블록 D일
    "block_end_date": "2019-10-15",       # 2번 블록 종료일 (60이평선 회귀)
    "current_date": "2020-03-15",         # 분석 현재 시점
    "total_analysis_days": 208,           # 총 분석 일수 (2번 블록 D일 ~ 현재)

    # 공매도 분석
    "short_selling": {
        "total_short_volume": 5000000,         # 기간 내 공매도 총 거래량
        "avg_short_ratio": 8.5,                # 평균 공매도 비중 (%)
        "short_balance_change": -2000000,      # 공매도 잔고 변화 (주)
        "short_pattern": "감소",                # 패턴: "증가" or "감소" or "안정"
        "peak_short_date": "2019-08-25",       # 공매도 최대 발생일
        "peak_short_ratio": 15.2,              # 최대 공매도 비중 (%)
    },

    # 프로그램 매매
    "program_trading": {
        "net_buy": 15000000000,                # 프로그램 순매수 (원)
        "arbitrage_buy": 8000000000,           # 차익거래 매수 (원)
        "non_arbitrage_buy": 7000000000,       # 비차익거래 매수 (원)
        "program_ratio": 35.5,                 # 프로그램 매매 비중 (%)
        "trend": "순매수",                      # 트렌드: "순매수" or "순매도"
    }
}
```

### 2.3.2 투자자별 수급

**외국인 투자자**
- 외국인 순매수/순매도
- 외국인 보유 비중 변화
- 외국인 매매 트렌드 (지속일수)
- 누적 수급 트렌드 (기울기, 추세 방향, 일관성)
- 매수/매도 일수 및 비율
- 평균 매수강세 지수

**기관 투자자**
- 기관 순매수/순매도
- 기관별 매매 현황 (연기금, 투신, 보험 등)
- 기관 매매 트렌드
- 누적 수급 트렌드 (기울기, 추세 방향, 일관성)
- 매수/매도 일수 및 비율
- 평균 매수강세 지수

**개인 투자자**
- 개인 순매수/순매도
- 누적 수급 트렌드 (기울기, 추세 방향, 일관성)
- 매수/매도 일수 및 비율
- 평균 매수강세 지수

**프로그램 투자자**
- 프로그램 순매수/순매도
- 누적 수급 트렌드 (기울기, 추세 방향, 일관성)
- 매수/매도 일수 및 비율
- 평균 매수강세 지수

**외국인+기관 합산**
- 외국인+기관 순매수/순매도
- 누적 수급 트렌드 (기울기, 추세 방향, 일관성)
- 매수/매도 일수 및 비율
- 평균 매수강세 지수
- 투자 주체 간 수급 균형

**데이터 구조:**
```python
investor_analysis = {
    # 분석 기간
    "analysis_start_date": "2019-08-20",  # 2번 블록 D일
    "block_end_date": "2019-10-15",       # 2번 블록 종료일 (60이평선 회귀)
    "current_date": "2020-03-15",         # 분석 현재 시점
    "total_analysis_days": 208,           # 총 분석 일수 (2번 블록 D일 ~ 현재)

    # 외국인 투자자
    "foreign_investor": {
        "net_buy_value": 25000000000,          # 순매수 금액 (원)
        "net_buy_shares": 500000,              # 순매수 주식수
        "ownership_change": 2.5,               # 보유 비중 변화 (%)
        "ownership_start": 15.2,               # 기간 시작 시 보유 비중 (%)
        "ownership_end": 17.7,                 # 기간 종료 시 보유 비중 (%)
        "consecutive_buy_days": 35,            # 연속 순매수 일수
        "trend": "강한 매수",                   # 트렌드: "강한 매수/매수/중립/매도/강한 매도"

        # 누적 수급 트렌드
        "cumulative_start": 12000000000,       # 기간 시작 시 누적 순매수 (원)
        "cumulative_end": 37000000000,         # 기간 종료 시 누적 순매수 (원)
        "trend_slope": 120192307.69,           # 선형 회귀 기울기 (원/일)
        "trend_direction": "상승",              # 추세 방향: "상승" or "하락" or "횡보"
        "r_squared": 0.89,                     # 결정계수 (추세 일관성, 0~1)
        "buying_days": 140,                    # 순매수 발생 일수
        "selling_days": 68,                    # 순매도 발생 일수
        "buying_ratio": 67.3,                  # 순매수 일수 비율 (%)
        "avg_buying_strength": 3.8,            # 평균 매수강세 지수 (%)
    },

    # 기관 투자자
    "institutional_investor": {
        "net_buy_value": 18000000000,          # 순매수 금액 (원)
        "net_buy_shares": 360000,              # 순매수 주식수
        "consecutive_buy_days": 28,            # 연속 순매수 일수
        "trend": "매수",                        # 트렌드

        # 누적 수급 트렌드
        "cumulative_start": 8000000000,        # 기간 시작 시 누적 순매수 (원)
        "cumulative_end": 26000000000,         # 기간 종료 시 누적 순매수 (원)
        "trend_slope": 86538461.54,            # 선형 회귀 기울기 (원/일)
        "trend_direction": "상승",              # 추세 방향: "상승" or "하락" or "횡보"
        "r_squared": 0.85,                     # 결정계수 (추세 일관성, 0~1)
        "buying_days": 125,                    # 순매수 발생 일수
        "selling_days": 83,                    # 순매도 발생 일수
        "buying_ratio": 60.1,                  # 순매수 일수 비율 (%)
        "avg_buying_strength": 2.9,            # 평균 매수강세 지수 (%)

        # 기관별 상세
        "by_type": {
            "pension": 8000000000,             # 연기금
            "investment_trust": 6000000000,    # 투신
            "insurance": 4000000000,           # 보험
            "bank": -500000000,                # 은행 (순매도)
            "other": 500000000,                # 기타
        }
    },

    # 개인 투자자
    "individual_investor": {
        "net_buy_value": -43000000000,         # 순매도 금액 (원)
        "net_buy_shares": -860000,             # 순매도 주식수
        "consecutive_sell_days": 32,           # 연속 순매도 일수
        "trend": "강한 매도",                   # 트렌드

        # 누적 수급 트렌드
        "cumulative_start": -5000000000,       # 기간 시작 시 누적 순매수 (원)
        "cumulative_end": -48000000000,        # 기간 종료 시 누적 순매수 (원)
        "trend_slope": -206730769.23,          # 선형 회귀 기울기 (원/일)
        "trend_direction": "하락",              # 추세 방향: "상승" or "하락" or "횡보"
        "r_squared": 0.91,                     # 결정계수 (추세 일관성, 0~1)
        "buying_days": 68,                     # 순매수 발생 일수
        "selling_days": 140,                   # 순매도 발생 일수
        "buying_ratio": 32.7,                  # 순매수 일수 비율 (%)
        "avg_buying_strength": -6.7,           # 평균 매수강세 지수 (%)
    },

    # 프로그램 투자자
    "program_investor": {
        "net_buy_value": 15000000000,          # 프로그램 순매수 금액 (원)
        "consecutive_buy_days": 22,            # 연속 순매수 일수
        "trend": "매수",                        # 트렌드

        # 누적 수급 트렌드
        "cumulative_start": 3000000000,        # 기간 시작 시 누적 순매수 (원)
        "cumulative_end": 18000000000,         # 기간 종료 시 누적 순매수 (원)
        "trend_slope": 72115384.62,            # 선형 회귀 기울기 (원/일)
        "trend_direction": "상승",              # 추세 방향: "상승" or "하락" or "횡보"
        "r_squared": 0.76,                     # 결정계수 (추세 일관성, 0~1)
        "buying_days": 118,                    # 순매수 발생 일수
        "selling_days": 90,                    # 순매도 발생 일수
        "buying_ratio": 56.7,                  # 순매수 일수 비율 (%)
        "avg_buying_strength": 1.8,            # 평균 매수강세 지수 (%)
    },

    # 외국인+기관 합산
    "foreign_institutional_combined": {
        "net_buy_value": 43000000000,          # 외국인+기관 순매수 금액 (원)
        "net_buy_shares": 860000,              # 외국인+기관 순매수 주식수
        "trend": "강한 매수",                   # 트렌드

        # 누적 수급 트렌드
        "cumulative_start": 20000000000,       # 기간 시작 시 누적 순매수 (원)
        "cumulative_end": 63000000000,         # 기간 종료 시 누적 순매수 (원)
        "trend_slope": 206730769.23,           # 선형 회귀 기울기 (원/일)
        "trend_direction": "상승",              # 추세 방향: "상승" or "하락" or "횡보"
        "r_squared": 0.93,                     # 결정계수 (추세 일관성, 0~1)
        "buying_days": 152,                    # 순매수 발생 일수
        "selling_days": 56,                    # 순매도 발생 일수
        "buying_ratio": 73.1,                  # 순매수 일수 비율 (%)
        "avg_buying_strength": 6.7,            # 평균 매수강세 지수 (%)
    },

    # 수급 균형 분석
    "supply_demand_balance": {
        "foreign_trend": "순매수",             # 외국인 순매수 추세: "순매수" or "순매도" or "중립"
        "institutional_trend": "순매수",       # 기관 순매수 추세: "순매수" or "순매도" or "중립"
        "individual_trend": "순매도",          # 개인 순매수 추세: "순매수" or "순매도" or "중립"

        "dominance": "외국인+기관",             # 주도 세력: "외국인" or "기관" or "개인" or "외국인+기관"
        "foreign_institutional_sync": True,    # 외국인-기관 동조화 여부
        "individual_resistance": "강함",       # 개인 저항 강도: "강함" or "보통" or "약함"
        "balance_score": 8.5,                  # 수급 균형 점수 (10점 만점)
        "interpretation": "외국인+기관 강한 매수 vs 개인 매도 → 긍정적 수급"
    }
}
```

---

## 2.4 산업 트렌드 분석

> **분석 기준 기간**: 1번 거래량 블록 D일 기준 2년 전부터 분석 현재 시점까지 지속적으로 분석

### 2.4.1 시장 및 대중 관심도

**검색 트렌드**
- 네이버/구글 검색량 분석
- 뉴스 언급 빈도
- 소셜미디어 (트위터, 주식 커뮤니티) 관심도

**미디어 노출도**
- 뉴스 기사 수 및 감성 분석
- 언론 보도 톤 (긍정/부정/중립)
- 애널리스트 리포트 발행 빈도

**데이터 구조:**
```python
market_interest_analysis = {
    # 분석 기간
    "analysis_start_date": "2017-03-15",  # 1번 블록 D일 - 2년
    "primary_block_date": "2019-03-15",   # 1번 블록 D일
    "secondary_block_date": "2019-08-20", # 2번 블록 D일
    "current_date": "2020-03-15",         # 분석 현재 시점
    "total_analysis_days": 1096,          # 총 분석 일수 (2년 전 ~ 현재)

    # 검색 트렌드
    "search_trends": {
        "naver_search_volume": 85000,          # 네이버 검색량 (기간 합계)
        "google_search_volume": 12000,         # 구글 검색량 (기간 합계)
        "search_increase_rate": 450.5,         # 전월 대비 검색량 증가율 (%)
        "peak_search_date": "2019-09-10",      # 검색량 최고 날짜
        "news_mention_count": 125,             # 뉴스 언급 횟수
        "social_media_mentions": 8500,         # 소셜미디어 언급
        "trend_score": 9.2,                    # 관심도 점수 (10점 만점)
    },

    # 미디어 노출도
    "media_exposure": {
        "news_count": 125,                     # 뉴스 기사 수
        "positive_ratio": 65.5,                # 긍정 비율 (%)
        "negative_ratio": 8.2,                 # 부정 비율 (%)
        "neutral_ratio": 26.3,                 # 중립 비율 (%)
        "media_tone": "긍정",                   # 전반적 보도 톤
        "analyst_reports": 8,                  # 애널리스트 리포트 수
        "avg_target_price": 75000,             # 평균 목표가
        "upgrade_count": 5,                    # 투자의견 상향 건수
        "downgrade_count": 0,                  # 투자의견 하향 건수
        "exposure_score": 8.8,                 # 미디어 노출 점수 (10점 만점)
    }
}
```

### 2.4.2 산업 사이클 변화

**산업 내 위치**
- 해당 산업의 성장 단계 분석
- 산업 트렌드 변화의 선도 여부
- 경쟁사 대비 시장 점유율 변화

**산업 사이클**
- 산업별 경기 사이클 단계 (도입/성장/성숙/쇠퇴)
- 신기술/신제품 출시 사이클
- 규제 변화 및 정책 지원

**데이터 구조:**
```python
industry_cycle_analysis = {
    # 분석 기간
    "analysis_start_date": "2017-03-15",  # 1번 블록 D일 - 2년
    "primary_block_date": "2019-03-15",   # 1번 블록 D일
    "secondary_block_date": "2019-08-20", # 2번 블록 D일
    "current_date": "2020-03-15",         # 분석 현재 시점

    # 산업 내 위치
    "industry_position": {
        "industry_name": "2차전지",            # 산업명
        "growth_stage": "성장기",              # 도입/성장/성숙/쇠퇴
        "is_trend_leader": True,              # 산업 트렌드 선도 여부
        "market_share": 18.5,                 # 시장 점유율 (%)
        "market_share_change_1y": 5.2,        # 1년 전 대비 점유율 변화 (%)
        "market_rank": 2,                     # 업계 순위
        "rank_change_1y": 1,                  # 1년 전 대비 순위 변화 (상승: +)
    },

    # 산업 사이클
    "industry_cycle": {
        "cycle_stage": "성장기",               # 사이클 단계
        "industry_growth_rate": 35.5,         # 산업 성장률 (%)
        "new_product_launch": True,           # 신제품 출시 여부
        "new_technology": True,               # 신기술 도입 여부
        "regulatory_change": "지원 확대",      # 규제 변화: "지원 확대/중립/규제 강화"
        "government_support": True,           # 정부 정책 지원 여부
        "cycle_score": 9.5,                   # 산업 사이클 점수 (10점 만점)
    }
}
```

### 2.4.3 섹터/테마 주도주 분석

> **핵심 목적**: 해당 종목이 속한 섹터/테마에서 주도주(Leading Stock)인지 파악
> **중요성**: 주도주는 섹터 상승 시 가장 먼저, 가장 크게 상승하며, 하락 시 방어력도 강함

#### 주도주 판단 기준

**1) 상대 강도 분석 (Relative Strength)**
- 섹터/테마 내 다른 종목 대비 수익률 비교
- 섹터 지수 대비 초과 수익률
- 선행 상승 여부 (섹터 랠리 시작 시점보다 먼저 상승)

**2) 거래량 우위**
- 섹터 내 거래대금 순위
- 섹터 평균 대비 거래량 배율
- 거래량 증가 타이밍 (섹터 내 가장 먼저 증가)

**3) 시가총액 및 유동성**
- 섹터 내 시가총액 순위
- 기관/외국인 보유 비중
- 일평균 거래대금 (유동성)

**4) 뉴스/이슈 주도성**
- 섹터 대표 종목으로 언론 보도
- 애널리스트 리포트 발행 빈도
- 섹터 관련 뉴스 시 가장 먼저 언급

**데이터 구조:**
```python
sector_theme_leadership_analysis = {
    # 분석 기간
    "analysis_start_date": "2017-03-15",  # 1번 블록 D일 - 2년
    "primary_block_date": "2019-03-15",   # 1번 블록 D일
    "secondary_block_date": "2019-08-20", # 2번 블록 D일
    "current_date": "2020-03-15",         # 분석 현재 시점

    # 섹터/테마 분류
    "sector_theme": {
        "primary_sector": "2차전지",              # 주 섹터
        "sub_sectors": ["양극재", "전해액"],      # 세부 섹터
        "themes": [                               # 속한 테마 (복수 가능)
            "전기차",
            "그린뉴딜",
            "ESG"
        ],
        "sector_index": "KRX 2차전지 지수",       # 관련 섹터 지수
    },

    # 주도주 종합 점수
    "leadership_score": 9.2,                      # 주도주 점수 (0~10점)
    "leadership_grade": "A",                      # 주도주 등급 (S/A/B/C/D)

    # 1) 상대 강도 분석
    "relative_strength": {
        # 수익률 비교 (1번 블록 고점 기준 상승률)
        "return_1m": 45.5,                        # 1번 블록 고점 이후 1개월 상승률 (%)
        "sector_avg_return_1m": 22.3,             # 섹터 평균 1개월 상승률 (%)
        "outperformance_1m": 23.2,                # 초과 수익률 (%)

        "return_3m": 125.8,                       # 1번 블록 고점 이후 3개월 상승률 (%)
        "sector_avg_return_3m": 68.5,             # 섹터 평균 3개월 상승률 (%)
        "outperformance_3m": 57.3,                # 초과 수익률 (%)

        "return_6m": 285.5,                       # 1번 블록 고점 이후 6개월 상승률 (%)
        "sector_avg_return_6m": 142.3,            # 섹터 평균 6개월 상승률 (%)
        "outperformance_6m": 143.2,               # 초과 수익률 (%)

        # 섹터 지수 대비
        "vs_sector_index_1m": 18.5,               # 섹터 지수 대비 초과 수익률 1개월 (%)
        "vs_sector_index_3m": 45.2,               # 섹터 지수 대비 초과 수익률 3개월 (%)
        "vs_sector_index_6m": 98.7,               # 섹터 지수 대비 초과 수익률 6개월 (%)

        # 시장 지수 대비 (KOSPI/KOSDAQ)
        "market_index": "KOSDAQ",                 # 소속 시장 (KOSPI/KOSDAQ)
        "vs_kospi_1m": 35.2,                      # KOSPI 대비 초과 수익률 1개월 (%)
        "vs_kospi_3m": 88.5,                      # KOSPI 대비 초과 수익률 3개월 (%)
        "vs_kospi_6m": 215.8,                     # KOSPI 대비 초과 수익률 6개월 (%)
        "vs_kosdaq_1m": 28.7,                     # KOSDAQ 대비 초과 수익률 1개월 (%)
        "vs_kosdaq_3m": 75.3,                     # KOSDAQ 대비 초과 수익률 3개월 (%)
        "vs_kosdaq_6m": 195.2,                    # KOSDAQ 대비 초과 수익률 6개월 (%)

        # 섹터의 시장 지수 대비 상승률
        "sector_vs_kospi_1m": 12.5,               # 섹터 지수의 KOSPI 대비 1개월 초과 수익률 (%)
        "sector_vs_kospi_3m": 35.8,               # 섹터 지수의 KOSPI 대비 3개월 초과 수익률 (%)
        "sector_vs_kospi_6m": 85.5,               # 섹터 지수의 KOSPI 대비 6개월 초과 수익률 (%)
        "sector_vs_kosdaq_1m": 8.2,               # 섹터 지수의 KOSDAQ 대비 1개월 초과 수익률 (%)
        "sector_vs_kosdaq_3m": 28.5,              # 섹터 지수의 KOSDAQ 대비 3개월 초과 수익률 (%)
        "sector_vs_kosdaq_6m": 72.3,              # 섹터 지수의 KOSDAQ 대비 6개월 초과 수익률 (%)

        # 선행성
        "is_early_mover": True,                   # 섹터 랠리 선행 여부
        "sector_rally_start_date": "2019-02-20",  # 섹터 랠리 시작일
        "stock_rally_start_date": "2019-02-10",   # 해당 종목 상승 시작일
        "lead_days": 10,                          # 선행 일수 (양수: 선행, 음수: 후행)

        # 상대 강도 점수
        "relative_strength_rank": 2,              # 섹터 내 상대 강도 순위
        "total_stocks_in_sector": 45,             # 섹터 내 총 종목 수
        "relative_strength_percentile": 95.6,     # 상대 강도 백분위 (%)
        "rs_score": 9.5,                          # 상대 강도 점수 (10점 만점)
    },

    # 2) 거래량 우위
    "volume_dominance": {
        # 거래대금
        "avg_daily_trading_value": 250000000000,  # 일평균 거래대금 (원)
        "sector_avg_trading_value": 85000000000,  # 섹터 평균 거래대금 (원)
        "trading_value_rank": 1,                  # 섹터 내 거래대금 순위
        "trading_value_ratio": 2.94,              # 섹터 평균 대비 배율

        # 거래량 증가
        "volume_increase_rate": 850.5,            # 전월 대비 거래량 증가율 (%)
        "sector_avg_volume_increase": 320.2,      # 섹터 평균 거래량 증가율 (%)
        "volume_increase_rank": 1,                # 섹터 내 거래량 증가율 순위

        # 거래량 타이밍
        "volume_surge_date": "2019-02-08",        # 거래량 급증 시작일
        "sector_volume_surge_date": "2019-02-18", # 섹터 평균 거래량 급증일
        "volume_lead_days": 10,                   # 거래량 선행 일수
        "is_volume_leader": True,                 # 거래량 선행 여부

        "volume_score": 9.8,                      # 거래량 우위 점수 (10점 만점)
    },

    # 3) 시가총액 및 수급
    "market_cap_supply": {
        # 시가총액
        "market_cap": 15000000000000,             # 시가총액 (원)
        "market_cap_rank": 1,                     # 섹터 내 시총 순위
        "market_cap_share": 22.5,                 # 섹터 내 시총 비중 (%)

        # 1번 거래량 블록 D일 수급
        "block_1_d_institutional_buy": 5000000000,    # 1번 블록 D일 기관 매수 금액 (원)
        "block_1_d_foreign_buy": 8000000000,          # 1번 블록 D일 외국인 매수 금액 (원)
        "block_1_d_is_institutional_buying": True,    # 1번 블록 D일 기관 순매수 여부
        "block_1_d_is_foreign_buying": True,          # 1번 블록 D일 외국인 순매수 여부

        # 2번 거래량 블록 D일 수급
        "block_2_d_institutional_buy": 12000000000,   # 2번 블록 D일 기관 매수 금액 (원)
        "block_2_d_foreign_buy": 15000000000,         # 2번 블록 D일 외국인 매수 금액 (원)
        "block_2_d_is_institutional_buying": True,    # 2번 블록 D일 기관 순매수 여부
        "block_2_d_is_foreign_buying": True,          # 2번 블록 D일 외국인 순매수 여부

        # 2번 거래량 블록 D+1일 수급
        "block_2_d1_institutional_buy": 8000000000,   # 2번 블록 D+1일 기관 매수 금액 (원)
        "block_2_d1_foreign_buy": 10000000000,        # 2번 블록 D+1일 외국인 매수 금액 (원)
        "block_2_d1_is_institutional_buying": True,   # 2번 블록 D+1일 기관 순매수 여부
        "block_2_d1_is_foreign_buying": True,         # 2번 블록 D+1일 외국인 순매수 여부

        # 2번 거래량 블록 D+2일 수급
        "block_2_d2_institutional_buy": 6000000000,   # 2번 블록 D+2일 기관 매수 금액 (원)
        "block_2_d2_foreign_buy": 7000000000,         # 2번 블록 D+2일 외국인 매수 금액 (원)
        "block_2_d2_is_institutional_buying": True,   # 2번 블록 D+2일 기관 순매수 여부
        "block_2_d2_is_foreign_buying": True,         # 2번 블록 D+2일 외국인 순매수 여부

        # 유동성
        "avg_daily_turnover_ratio": 8.5,          # 일평균 회전율 (%)
        "liquidity_rank": 1,                      # 섹터 내 유동성 순위
        "is_highly_liquid": True,                 # 고유동성 여부 (일 거래대금 500억 이상)

        "supply_score": 9.2,                      # 수급 점수 (10점 만점)
    },

    # 4) 뉴스/이슈 주도성
    "news_leadership": {
        # 언론 보도
        "news_mention_count": 285,                # 뉴스 언급 횟수 (기간 내)
        "sector_avg_news_count": 85,              # 섹터 평균 뉴스 횟수
        "news_mention_rank": 1,                   # 섹터 내 뉴스 언급 순위

        # 섹터 대표성
        "is_sector_representative": True,         # 섹터 대표 종목 여부
        "sector_news_mention_ratio": 45.5,        # 섹터 관련 뉴스 중 언급 비율 (%)

        # 애널리스트 커버리지
        "analyst_coverage": 18,                   # 커버리지 애널리스트 수
        "sector_avg_coverage": 6,                 # 섹터 평균 커버리지
        "analyst_reports_1y": 52,                 # 1년간 리포트 발행 건수
        "target_price_consensus": 95000,          # 컨센서스 목표가
        "buy_rating_ratio": 85.5,                 # 매수 의견 비율 (%)

        # 검색 트렌드
        "search_volume": 125000,                  # 검색량 (기간 합계)
        "sector_avg_search": 38000,               # 섹터 평균 검색량
        "search_rank": 1,                         # 섹터 내 검색량 순위

        "media_leadership_score": 9.5,            # 언론 주도성 점수 (10점 만점)
    },

    # 주도주 패턴 분석
    "leadership_pattern": {
        # 주도주 전환 시점
        "became_leader_date": "2019-01-15",       # 주도주 전환 시점
        "leadership_duration_days": 420,          # 주도주 지속 기간 (일)
        "is_consistent_leader": True,             # 지속적 주도주 여부 (3개월 이상)

        # 섹터 랠리 주도
        "led_sector_rally": True,                 # 섹터 랠리 주도 여부
        "sector_rally_correlation": 0.92,         # 섹터 지수와 상관계수
        "leads_sector_index": True,               # 섹터 지수 선행 여부

        # 경쟁 주도주
        "competing_leaders": [                    # 경쟁 주도주 종목
            {"name": "LG화학", "leadership_score": 8.8},
            {"name": "삼성SDI", "leadership_score": 8.5},
        ],
        "leadership_advantage": 0.4,              # 2위 대비 점수 차이
    }
}
```

#### 주도주 등급 산정



#### 시각화 예시

```
[섹터 내 상대 강도 비교]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
종목명          6개월 수익률    섹터 대비    주도성
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
LG에너지솔루션   +285.5%       +143.2%      ★ 주도주
삼성SDI         +195.3%        +53.0%      준주도주
LG화학          +178.8%        +36.5%      준주도주
포스코케미칼     +142.3%         +0.0%      평균
에코프로         +98.5%        -43.8%      후행주
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[거래대금 순위]
1. LG에너지솔루션  2,500억 (섹터 평균의 2.94배) ★
2. 삼성SDI        1,850억 (섹터 평균의 2.18배)
3. LG화학         1,620억 (섹터 평균의 1.91배)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[시계열 주도성 분석]
2019-02-10 ▶ LG에너지솔루션 상승 시작 (+10% 급등)
2019-02-18 ▶ 섹터 평균 상승 시작 (8일 선행) ✓
2019-02-20 ▶ 섹터 지수 상승 전환 (10일 선행) ✓
→ 주도주 확정: 선행 상승 + 섹터 견인
```

### 2.4.4 미래 산업 포함 여부

**미래 성장 산업 분류**
- AI/빅데이터
- 전기차/2차전지
- 바이오/헬스케어
- 반도체/첨단소재
- 신재생에너지
- 로봇/자동화
- 메타버스/콘텐츠

**기술 혁신성**
- R&D 투자 비중
- 특허 출원 및 등록 현황
- 신제품/신기술 개발 파이프라인

**정부 정책 부합도**
- 국가 전략 산업 포함 여부
- 정부 지원금/보조금 수혜
- 규제 완화 혜택

**데이터 구조:**
```python
future_industry_analysis = {
    # 분석 기간
    "analysis_start_date": "2017-03-15",  # 1번 블록 D일 - 2년
    "primary_block_date": "2019-03-15",   # 1번 블록 D일
    "secondary_block_date": "2019-08-20", # 2번 블록 D일
    "current_date": "2020-03-15",         # 분석 현재 시점

    # 미래 성장 산업 분류
    "future_industry": {
        "is_future_industry": True,           # 미래 성장 산업 여부
        "categories": [                       # 해당 분야 (복수 가능)
            "전기차/2차전지",
            "신재생에너지"
        ],
        "primary_category": "전기차/2차전지",  # 주력 분야
        "future_industry_score": 9.0,         # 미래 산업 점수 (10점 만점)
    },

    # 기술 혁신성
    "technology_innovation": {
        "rnd_ratio": 8.5,                     # R&D 투자 비중 (매출 대비 %)
        "rnd_investment": 50000000000,        # R&D 투자액 (원, 연간)
        "patent_applications_1y": 85,         # 1년간 특허 출원 건수
        "patent_registrations_1y": 42,        # 1년간 특허 등록 건수
        "new_product_pipeline": 5,            # 신제품 개발 파이프라인 (개)
        "new_technology_pipeline": 3,         # 신기술 개발 파이프라인 (개)
        "innovation_score": 8.2,              # 기술 혁신성 점수 (10점 만점)
    },

    # 정부 정책 부합도
    "government_policy": {
        "is_national_strategy": True,         # 국가 전략 산업 포함 여부
        "subsidy_received_1y": 8000000000,    # 1년간 정부 지원금/보조금 (원)
        "regulatory_benefits": [              # 규제 완화 혜택
            "세액 공제",
            "R&D 지원",
            "저리 융자"
        ],
        "policy_alignment_score": 9.5,        # 정책 부합도 점수 (10점 만점)
    },

    # 종합 평가
    "overall_assessment": {
        "total_score": 8.9,                   # 종합 점수 (10점 만점)
        "grade": "A+",                        # 등급 (S/A+/A/B+/B/C/D)
        "interpretation": "미래 성장 산업 + 높은 기술 혁신성 + 정부 강력 지원 → 최상급 성장 잠재력"
    }
}
```

---

## 3. 개발 방향

### 3.1 데이터 수집

- **대상 기간**: 2015년 ~ 2025년 (10년)
- **시장**: KOSPI, KOSDAQ 전체 종목
- **목표**: 1번 거래량 블록 + 2번 거래량 블록을 모두 만족하는 케이스 수집

#### 3.1.1 데이터 소스

**주가/거래 데이터 (pykrx - 추천)**

- **제공 데이터**: OHLCV, 거래량, 거래대금, 투자자별 매매, 공매도, 프로그램 매매
- **장점**: 무료, 한국거래소 공식 데이터, API 제한 없음
- **기간**: 2000년대 초반부터 현재까지

**재무제표 데이터 (dart-fss)**

- **제공 데이터**: 전체 재무제표 (분기별/연도별)
- **장점**: 무료, 금융감독원 공식 데이터
- **기간**: 상장 이후 전체 기간

**검색/뉴스 데이터**


**거시경제 지표 (FinanceDataReader)**


**산업 분류**


**데이터 수집 범위:**
- **기간**: 2015년 ~ 2025년 (10년)
- **시장**: KOSPI, KOSDAQ 전체 종목
- **빈도**: 일별 (OHLCV, 거래량), 분기별 (재무제표)

**데이터 수집 시점 정의:**
> **중요**: 각 분석 항목별로 수집 시점이 다름

| 분석 항목 | 수집 시작 시점 | 수집 종료 시점 | 설명 |
|----------|-------------|-------------|------|
| **거래량 블록 탐지** | 2년 전 | 1번/2번 블록 발생일 | 2년래 최대 거래량 판단 위해 |
| **당일 수급 (스냅샷)** | 1번 D일, 2번 D/D+1/D+2일 | 해당 당일 | 각 날짜의 순매수/순매도만 |
| **재무제표 트렌드** | 1번 블록 D일 | 분석 현재 시점 | 1번 블록 이후 지속 모니터링 |
| **수급 트렌드** | 2번 블록 D일 | 분석 현재 시점 | 기간 매매 추세 분석 |
| **산업 트렌드** | 1번 블록 D일 - 2년 | 분석 현재 시점 | 검색량, 뉴스, 관심도 추세 |
| **장기 가격 흐름** | 2번 블록 고점 | +5년 | 라벨링용 수익률 추적 |

#### 3.1.2 수집 데이터 구조

**1번 거래량 블록 데이터**
- **기본 정보**
  - D일 날짜 및 OHLCV
  - 거래대금 및 점수 (500억원 기준)
  - 2년래 최대 거래량 여부
- **D일 당일 수급 데이터 (스냅샷)**
  - 기관/외국인/외국인+기관/개인 순매수 금액
  - 각 주체별 순매수 여부 (Boolean)
- **신고가 분석**
  - 2년래 신고가 여부
  - 2년 내 최고가
- **블록 범위 데이터**
  - 1번 D일 ~ 2번 D일 전날까지
  - 블록 기간 최고가/최저가
  - 평균 일 거래량
  - **지수 대비 성과**
    - 블록 기간 종목/지수 수익률
    - 상대 수익률 (종목 - 지수)
    - 베타 (시장 대비 민감도)
    - 알파 (초과 수익률)
    - 시장 대비 초과 성과 여부
    - 최고가 시점 지수 대비 초과 수익률

**2번 거래량 블록 데이터**
- **기본 정보**
  - 1번 블록 발생일로부터 경과 일수 (6개월 내)
  - D, D+1, D+2 일자 및 각각의 OHLCV
  - 1번 블록 대비 거래량 비율 (80% 이상)
- **D, D+1, D+2 당일 수급 데이터 (스냅샷)**
  - 각 날짜별 기관/외국인/외국인+기관/개인 순매수 금액
  - 각 주체별 순매수 여부 (Boolean)
- **패턴 매칭**
  - D+D+1, D+D+2, D+D+1+D+2 패턴 만족 여부
  - 매칭된 패턴명
- **거래대금 조건**
  - D, D+1, D+2 중 2000억원 이상 여부
- **14일 이상 고가 위 종가 형성 기간**
- **블록 범위 데이터 (60일 이동평균선 기준)**
  - 2번 D일 ~ 60이평선 회귀일
  - 블록 기간 최고가 (★ 수익률 기준점)
  - 60이평선 터치/하방이탈 여부
  - **지수 대비 성과**
    - 블록 기간 종목/지수 수익률
    - 상대 수익률, 베타, 알파
    - 최고가 시점 지수 대비 초과 수익률
- **신고가 분석**
  - 2년/5년/10년/역사적 신고가 여부
  - 각 기간별 최고가 및 달성일
  - 신고가 등급 (S/A/B/C/D/E/F)

**3번 거래량 블록 데이터**
- **기본 정보**
  - 2번 블록 발생 이후 6개월 내
  - 2번 블록 최대 거래량 대비 15% 이상
  - 2번 블록 최고가 대비 ±12% 이내
- **D일 거래량, 가격, 거래대금 데이터**
  - D일 거래량, OHLCV
  - D일 거래대금
  - 2번 블록 대비 거래량 비율
  - 2번 블록 최고가 대비 가격 차이
- **D일 수급 데이터 (스냅샷)**
  - 기관/외국인/외국인+기관/개인/프로그램 순매수 금액
  - 각 주체별 매수강세 지수
  - 쌍끌이 여부
- **품질 평가**
  - 품질 점수 (10점 만점)
  - 품질 등급 (S/A/B/C)
- **블록 범위 데이터**
  - 블록 기간 최고가/최저가
  - 평균 일 거래량
  - 지수 대비 성과 (상대 수익률, 베타, 알파)

**4번 거래량 블록 데이터**
- **기본 정보**
  - 3번 블록 이후 발생하는 2차 추가 거래량 블록
  - 2번 블록 최대 거래량 대비 15% 이상
  - 2번 블록 최고가 대비 ±12% 이내
- **D일 거래량, 가격, 거래대금 데이터**
  - (3번 블록과 동일 구조)
- **D일 수급 데이터 (스냅샷)**
  - (3번 블록과 동일 구조)
- **품질 평가**
  - (3번 블록과 동일 구조)
- **블록 범위 데이터**
  - (3번 블록과 동일 구조)

**재무제표 트렌드 데이터**
- **수집 기간**: 1번 블록 D일 ~ 분석 현재 시점
- **모니터링 방식**: 1번 블록 발생 이후 지속적으로 실적 개선/악화 추적
- **영업이익 트렌드**
  - 분기별 영업이익, 영업이익률
  - 적자→흑자 전환 시점
  - 연속 증가 분기 수
  - ROE, ROA 추이
  - 컨센서스 대비 실적 서프라이즈
- **자본 총계 트렌드**
  - 분기별 자본 총계 증가율
  - 연속 증가 분기 수
  - 이익잉여금 누적 추이
  - 부채비율 변화

**수급 트렌드 데이터 (기간 분석)**
- **수집 기간**: 2번 블록 D일 ~ 분석 현재 시점
- **외국인 투자자**
  - 순매수 금액 및 주식수
  - 보유 비중 변화
  - 연속 순매수/순매도 일수
  - 매매 트렌드 강도
  - **누적 수급 트렌드**
    - 누적 순매수 (시작/종료)
    - 선형 회귀 기울기 (원/일)
    - 추세 방향 (상승/하락/횡보)
    - R-squared (추세 일관성, 0~1)
    - 순매수/순매도 일수 및 비율
    - 평균 매수강세 지수
- **기관 투자자**
  - 순매수 금액 및 주식수
  - 기관별 매매 현황 (연기금/투신/보험 등)
  - 연속 순매수/순매도 일수
  - **누적 수급 트렌드**
    - (외국인 투자자와 동일 구조)
- **개인 투자자**
  - 순매수 금액 및 주식수
  - 연속 순매수/순매도 일수
  - **누적 수급 트렌드**
    - (외국인 투자자와 동일 구조)
- **프로그램 투자자**
  - 프로그램 순매수 금액
  - 연속 순매수/순매도 일수
  - **누적 수급 트렌드**
    - (외국인 투자자와 동일 구조)
- **외국인+기관 합산**
  - 외국인+기관 순매수 금액 및 주식수
  - **누적 수급 트렌드**
    - (외국인 투자자와 동일 구조)
- **수급 균형 분석**
  - 외국인/기관/개인 각 추세
  - 주도 세력
  - 외국인-기관 동조화 여부
  - 수급 균형 점수
- **공매도/프로그램 매매**
  - 공매도 비중 및 잔고 변화
  - 프로그램 순매수/순매도
  - 차익거래/비차익거래 구분

**산업 트렌드 데이터**
- **수집 기간**: 1번 블록 D일 기준 2년 전 ~ 분석 현재 시점
- **시장 및 대중 관심도**
  - 네이버/구글 검색량
  - 뉴스 기사 수 및 감성 분석
  - 애널리스트 리포트 수
- **산업 사이클 변화**
  - 산업 성장 단계
  - 시장 점유율 변화
  - 신기술/신제품 출시 여부
- **미래 산업 포함 여부**
  - 미래 성장 산업 분류 (AI/2차전지/바이오 등)
  - R&D 투자 비중
  - 특허 출원/등록 현황
  - 정부 지원금/보조금 수혜

**장기 가격 흐름 데이터 (라벨링용)**
- **기준일**: 2번 거래량 블록 고점 (D, D+1, D+2 중 최고가)
- **추적 기간**: 최대 5년
- **수집 데이터**:
  - **수익률 추적**
    - 6개월, 1년, 2년, 3년, 5년 시점 수익률
    - 최고가 도달 시점 및 수익률
    - 수익률 구간 분류 (Level 0~4: 실패~초고수익)
  - **기간 분석**
    - 50% 도달까지 소요 일수 (days_to_50pct)
    - 100% 도달까지 소요 일수 (days_to_100pct)
    - 최고 수익률 도달 일수 (days_to_peak)
    - 기간 구간 분류 (초단기/단기/중기/장기/미달성)
  - **최대 낙폭(MDD) 분석**
    - 2번 블록 고점 대비 최대 하락률 (mdd_from_block_high)
    - MDD 발생일 (mdd_date)
    - MDD까지 소요 일수 (days_to_mdd)
    - MDD 심각도 (경미/보통/심각/매우심각)
  - **실패 케이스 상세 분석** (Level 0인 경우)
    - 5년 후 최종 수익률 (final_return_5y)
    - 지속 하락 여부 (is_continuous_decline)
    - 5년 중 최고 수익률 (max_return_during_5y)
    - 최고점 이후 하락폭 (decline_after_peak)
    - 블록 고점 아래 머문 일수 (below_block_high_days)
    - 실패 패턴 유형 (실패-지속하락/실패-횡보 등)
  - **리스크-수익 프로파일**
    - 리스크-수익 비율 (max_return / |MDD|)
    - 주요 가격 변곡점 (고점, 저점)

### 3.2 데이터 전처리

**기본 전처리**
- 결측치 처리
- 이상치 탐지 및 제거
- 데이터 정규화/표준화
- 주식 분할, 배당 등 조정
- 시계열 데이터 정렬 및 동기화

**거래량 블록 탐지 알고리즘**

#### 1번 거래량 블록 탐지

- **입력**: 주가 데이터(최소 2년), 검사 날짜
- **알고리즘**:
  1. 2년래 최대 거래량 여부 확인 (`is_2y_max = volume == max(volume_2y)`)
  2. 거래대금 500억원 이상 확인 (`trading_value >= 500`)
  3. D일 수급 데이터 수집 (pykrx API 활용)
- **출력**: 1번 블록 확정 여부(Boolean), 블록 정보(dict)

#### 2번 거래량 블록 탐지

- **입력**: 주가 데이터, 1번 블록 D일, 후보 날짜
- **알고리즘**:
  1. 6개월 내 발생 확인 (`days_diff <= 180`)
  2. 1번 블록 대비 80% 이상 거래량 확인 (`d_volume >= primary_volume × 0.8`)
  3. D+1, D+2 패턴 검증:
     - D+1 조건: `d1_volume >= d_volume × 0.5` AND `d1_high > d_high`
     - D+2 조건: `d2_volume >= d_volume × 0.5` AND `d2_high > d_high`
     - 패턴: "D+D+1", "D+D+2", "D+D+1+D+2" 중 하나
  4. 필수 조건 4가지 검증 (거래량 돌파, 고가 돌파, 거래대금 2000억 이상, 14일 조건)
- **출력**: 2번 블록 확정 여부(Boolean), 패턴명(str)

#### 60일 이동평균선 기반 블록 범위 탐지

- **입력**: 주가 데이터, 블록 시작일
- **알고리즘**:
  1. 60일 이동평균선 계산 (`ma60 = rolling_mean(close, 60)`)
  2. 블록 시작일 이후 순차 탐색:
     - 터치 조건: `low <= ma60`
     - 하방이탈 조건: `close < ma60`
  3. 첫 번째 조건 만족일 반환
- **출력**: 블록 종료일, 종료 유형("터치" or "하방이탈")

#### 14일 이상 고가 위 종가 형성 검증

- **입력**: 주가 데이터, 1번 블록 고가, 검증 기간(시작일, 종료일)
- **알고리즘**:
  1. 검증 기간 내 일별 순회
  2. `close > primary_high` 조건 만족 시 연속 일수 카운트
  3. 조건 미만족 시 카운트 초기화
  4. 최대 연속 일수 >= 14 여부 반환
- **출력**: 조건 만족 여부(Boolean)

**텍스트 데이터 전처리**
- 뉴스 기사 감성 분석 (긍정/부정/중립)
- 검색 트렌드 정규화
- 산업 키워드 매칭

### 3.3 모델 개발

> **중요**: 1.2 목표와 연결된 2단계 학습 전략

#### 3.3.1 비지도 학습 - 차별 팩터 발견

**목적**: 성공/실패 및 수익률 구간별(Level 0~4) 어떤 팩터가 차별화되는지 발견

**방법론**:

**Step 0: 탐색적 데이터 분석 (EDA)**
- **목적**: 데이터 전체 구조 파악 및 팩터 간 관계 이해
- **분석 방법**:
  - 기술 통계량 (평균, 중앙값, 표준편차, 분포)
  - 팩터 간 상관관계 분석
    - Pearson 상관계수 히트맵
    - Spearman 순위 상관계수 (비선형 관계)
  - 다중공선성 확인 (VIF, Variance Inflation Factor)
    - 신고가 등급과 외국인 순매수의 상관관계는?
    - 재무 턴어라운드와 미래 산업의 독립성은?
  - 팩터별 분포 시각화 (히스토그램, 박스플롯)
  - Level별 팩터 분포 비교
- **산출물**:
  - 상관관계 히트맵
  - VIF 스코어 (>10이면 다중공선성 의심)
  - 팩터별 분포 차트

**Step 1: 성공 vs 실패 팩터 분석 (Level 0 vs Level 1~4)**
- **목적**: 50% 이상 수익 발생 여부와 상관관계가 있는 팩터 발견
- **분석 방법**:
  - 전체 케이스를 Level 0(실패) vs Level 1~4(성공)로 2분류
  - Random Forest 분류 모델로 Feature Importance 추출
  - SHAP으로 성공/실패에 영향을 주는 팩터 순위화
  - 통계적 검정 (t-test, Mann-Whitney U test)으로 유의미한 차이 확인
- **탐색 질문** (데이터가 답을 제공):
  - **성공 케이스와 실패 케이스를 구분하는 핵심 팩터는 무엇인가?**
    - 신고가 등급과 성공률의 관계는? (선형? 비선형? 임계값 존재?)
    - 어떤 수급 주체(외국인/기관/개인/프로그램)가 성공에 영향을 미치는가?
    - 재무제표 변화 패턴(개선/악화/턴어라운드)과 성공의 관계는?
    - 산업 특성(미래산업/전통산업)이 성공률에 영향을 미치는가?
  - **실패 케이스(Level 0)의 공통 특징은 무엇인가?**
    - 어떤 팩터 값 범위에서 실패 확률이 높은가?
    - 실패 케이스에서 일관되게 부족한 팩터가 있는가?
    - 예상 외로 실패에 영향을 미치는 팩터가 있는가?

**Step 1.2: 블록 품질 점수 효과 분석**
- **목적**: 1번/2번 블록(필수)을 넘어 3번/4번 블록(품질)이 성공에 영향을 미치는지 확인
- **분석 방법**:
  - block_3_score, block_4_score와 성공률/Level의 상관관계 분석
  - 품질 점수 구간별(0-10점, 10-20점, 20-30점) 성공률 비교
  - 블록 개수별(1+2 vs 1+2+3 vs 1+2+3+4) 성과 비교
  - 품질 점수와 리스크(MDD) 관계 분석
- **탐색 질문** (데이터가 답을 제공):
  - **3번/4번 블록이 성공에 영향을 미치는가?**
    - 3번 블록이 있으면 성공률이 높아지는가?
    - 4번 블록이 추가되면 추가 이득이 있는가?
    - 품질 점수가 높을수록 Level이 상승하는가?
  - **품질 점수와 리스크의 관계는?**
    - 품질 점수가 높으면 MDD가 낮아지는가?
    - 품질 점수가 수익 실현 기간에 영향을 미치는가?
  - **블록 개수의 한계 효용은?**
    - 1+2+3+4 모두 있는 것이 최선인가?
    - 어느 시점부터 추가 블록의 효과가 미미한가?

**Step 1.3: 수급 데이터 타입 효과 비교**
- **목적**: 수급 스냅샷(D일 당일) vs 추세(기간 누적) 데이터 중 어느 것이 성공 예측에 유용한지 확인
- **분석 방법**:
  - 스냅샷 팩터만 사용한 모델 (d_foreign_net_buy, d_institutional_net_buy, ...)
  - 추세 팩터만 사용한 모델 (cumulative_start/end, trend_slope, r_squared, ...)
  - 두 가지 모두 사용한 모델
  - Feature Importance 및 예측 성능(AUC, F1) 비교
- **탐색 질문** (데이터가 답을 제공):
  - **스냅샷 vs 추세 중 어느 것이 더 중요한가?**
    - D일 당일 순매수가 중요한가, 기간 추세가 중요한가?
    - 각 데이터 타입의 Feature Importance 순위는?
  - **스냅샷과 추세가 상충하면 어떻게 되는가?**
    - D일 순매도인데 추세는 상승: 어느 것을 신뢰?
    - D일 순매수인데 추세는 하락: 성공 확률은?
  - **두 데이터 타입의 관계는?**
    - 보완적인가, 중복인가?
    - 두 가지를 함께 사용하면 성능이 향상되는가?

**Step 1.5: 성공 케이스 내 Level별 차별 팩터 분석 (Level 1~4)**
- **목적**: 성공한 케이스 중에서도 수익률 구간(Level)을 결정하는 팩터 발견
- **분석 방법**:
  - 성공 케이스(Level 1~4)만 필터링
  - K-means, DBSCAN, Hierarchical Clustering으로 그룹화
  - PCA, t-SNE, UMAP으로 Level 1~4 분포 시각화
  - Random Forest 회귀/다중분류로 Level 결정 팩터 추출
  - SHAP으로 고수익(Level 3~4) 달성 조건 분석
- **탐색 질문** (데이터가 답을 제공):
  - **어떤 팩터가 Level 상승과 상관관계가 있는가?**
    - 각 팩터와 Level의 상관계수는? (선형? 지수적?)
    - Level 1→2, 2→3, 3→4 각 구간별로 중요한 팩터가 다른가?
    - 팩터 조합이 Level에 영향을 미치는가?
    - 예상 외로 Level과 무관한 팩터가 있는가?
  - **초고수익(Level 4, 1000%+)을 달성한 케이스의 특징은?**
    - Level 4와 Level 3을 구분하는 결정적 차이는?
    - Level 4에서만 나타나는 독특한 패턴이 있는가?
    - 어떤 팩터 조합이 Level 4 확률을 높이는가?

**Step 2: 팩터 조합 효과 분석**
- **목적**: 단일 팩터가 아닌 **팩터 조합의 효과** 발견
- **분석 방법**:
  - **연속형 팩터 조합 분석**:
    - 2-way, 3-way 교호작용(Interaction) 효과 분석 (ANOVA, 회귀분석)
    - Polynomial Features로 비선형 조합 탐색 (예: volume × trading_value)
    - Random Forest/XGBoost Feature Interaction 분석
    - SHAP Interaction Values로 팩터 간 상호작용 시각화
  - **범주형 팩터 조합 분석**:
    - 범주형 팩터 조합의 효과 (예: 신고가등급 × 주도성등급)
    - Chi-square test (범주형 팩터 간 독립성 검정)
    - Conditional probability 분석 (A 조건 하에서 B의 영향)
  - **혼합형 분석** (연속형 + 범주형):
    - Decision Tree로 if-then 규칙 추출
    - Stratified 분석 (범주별로 연속형 팩터 효과 비교)
- **탐색 질문** (데이터가 답을 제공):
  - **어떤 팩터 조합이 시너지 효과를 보이는가?**
    - 2개 팩터 조합 중 상승 작용이 있는 조합은?
    - 3개 이상 팩터 조합의 효과는? (과적합 주의)
    - 비선형 조합(곱셈, 거듭제곱)이 효과가 있는가?
  - **팩터 간 관계 패턴은?**
    - 독립적인 팩터는? (조합 무관하게 작용)
    - 조건부 팩터는? (다른 팩터가 있을 때만 효과)
    - 대체 가능한 팩터는? (A 또는 B 중 하나면 충분)
    - 상충하는 팩터는? (함께 있으면 효과 감소)
  - **범주별 연속형 팩터 효과 차이는?**
    - 신고가 S등급일 때 수급 추세의 영향은?
    - 주도주일 때 재무 팩터의 중요도가 다른가?

**Step 3: 시간/리스크 팩터 분석**
- **목적**: 수익률뿐 아니라 시간(기간)과 리스크(MDD)를 함께 분석
- **분석 방법**:
  - 수익률/기간/MDD를 포함한 3차원 클러스터링
  - 리스크-수익 비율 분석
  - 기간별 수익률 분포 분석
- **탐색 질문** (데이터가 답을 제공):
  - **수익 실현 기간과 팩터의 관계는?**
    - 어떤 팩터가 빠른 수익 실현과 상관관계가 있는가?
    - Level과 달성 기간의 관계는? (고수익일수록 빠른가? 느린가?)
    - 기간을 예측할 수 있는 팩터가 있는가?
  - **최대 낙폭(MDD)과 팩터의 관계는?**
    - 어떤 팩터가 낮은 MDD와 상관관계가 있는가?
    - Level과 MDD의 관계는? (고수익일수록 MDD도 높은가?)
    - MDD를 예측할 수 있는 팩터가 있는가?
  - **리스크-수익 비율이 좋은 케이스의 특징은?**
    - 고수익 + 낮은 MDD 조합을 달성한 케이스의 공통점은?
    - 빠른 달성 + 낮은 MDD 조합이 가능한가?

**Step 4: 추세 패턴 분석**
- **목적**: 요약된 추세 지표와 성공의 관계 분석
- **배경**: 2장에서 이미 시계열을 요약(trend_slope, r_squared, cumulative_start/end)했으므로, 요약 지표 기반 분석 수행
- **분석 방법**:
  - 추세 기울기(trend_slope)와 성공률/Level 상관관계
  - 추세 강도(r_squared)와 성공률 관계 (강한 추세 vs 약한 추세)
  - 추세 방향(상승/하락)과 성공률 비교
  - 추세 패턴 군집화 (slope × r_squared 2차원 클러스터링)
  - 턴어라운드 여부(is_op_turnaround, is_equity_turnaround)와 성공 관계
- **탐색 질문** (데이터가 답을 제공):
  - **재무 추세 지표와 성공의 관계는?**
    - 영업이익/자본총계 추세 기울기가 가파를수록 성공률이 높은가?
    - 추세 강도(r_squared)가 중요한가? (안정적 증가 vs 불안정 증가)
    - 턴어라운드(적자→흑자)가 성공에 결정적인가?
  - **수급 추세 지표와 성공의 관계는?**
    - 외국인/기관 누적 추세 기울기와 Level의 관계는?
    - 추세 방향(상승/하락)이 성공률에 영향을 미치는가?
    - 매수 강도(buying_strength)의 평균값이 중요한가?
  - **추세 강도의 의미는?**
    - R-squared가 높은(강한 추세) 케이스의 특징은?
    - R-squared가 낮은(불규칙) 케이스는 실패하는가?

**Step 5: 세분화 및 관점별 분석**
- **목적**: 세그먼트(산업/시장/규모/주도성)별 및 관점(기술/재무/수급/산업)별로 성공 패턴이 다른지 확인
- **분석 방법**:
  - **세그먼트별 분석**:
    - 산업별 독립 분석 및 팩터 중요도 비교
    - 시장별 독립 분석 (KOSPI vs KOSDAQ)
    - 시가총액별 독립 분석
    - 섹터/테마 주도성별 독립 분석
  - **관점별 독립 분석** (2장 팩터 기반):
    - **기술적 관점**: 거래량 블록, 신고가 등급, 지수 대비 성과, 초기 수익률
    - **재무 관점**: 영업이익/자본총계 추세, ROE/ROA, 턴어라운드
    - **수급 관점**: 투자자별 순매수(스냅샷), 누적 추세, 매수 강도
    - **산업 관점**: 주도성 등급, 미래산업, 관심도
  - **관점별 조합 분석**:
    - 2개 관점 조합 (기술+수급, 기술+재무, 수급+재무, ...)
    - 3개 관점 조합 (기술+수급+재무, ...)
    - 4개 전체 조합
  - 각 세그먼트/관점별 모델 성능(AUC, F1) 및 Feature Importance 비교
- **탐색 질문** (데이터가 답을 제공):
  - **세그먼트별 차이**:
    - **산업별로 중요한 팩터가 다른가?**
      - 각 산업에서 성공과 상관관계가 높은 팩터는?
      - 특정 산업에서만 중요한 팩터가 있는가?
      - 산업별 성공률/수익률/MDD의 차이는?
    - **시장(KOSPI/KOSDAQ)별로 패턴이 다른가?**
      - KOSPI와 KOSDAQ에서 중요한 팩터가 다른가?
      - 시장별 성공률/수익률/리스크 차이는?
    - **시가총액별로 패턴이 다른가?**
      - 대형주/중형주/소형주의 수익률/기간/MDD 특성은?
      - 시가총액별로 중요한 팩터가 다른가?
    - **섹터/테마 주도성별로 패턴이 다른가?**
      - 주도주/준주도주/비주도주의 성공률/수익률/MDD 차이는?
      - 주도성 등급과 다른 팩터(신고가, 수급 등)의 조합 효과는?
      - 섹터 랠리 유무에 따라 주도성의 영향력이 다른가?
  - **관점별 예측력**:
    - **각 관점의 독립적인 예측력은?**
      - 기술적 관점만으로 성공 예측 정확도는?
      - 재무 관점만으로 예측하면?
      - 수급 관점만으로 예측하면?
      - 산업 관점만으로 예측하면?
    - **어떤 관점이 가장 중요한가?**
      - 관점별 Feature Importance 순위는?
      - 관점별 예측 성능(AUC, F1) 비교 결과는?
    - **관점 조합의 시너지 효과는?**
      - 2개 관점 조합 시 성능 향상 정도는?
      - 최적 관점 조합은 무엇인가?
      - 4개 전체를 사용하는 것이 최선인가, 아니면 2-3개로 충분한가?
    - **투자 전략별 최적 관점은?**
      - 단기 투자(6개월): 어떤 관점이 유용한가?
      - 중기 투자(1-2년): 어떤 관점이 유용한가?
      - 장기 투자(3-5년): 어떤 관점이 유용한가?
      - 안정성 중시 투자(낮은 MDD): 어떤 관점이 유용한가?

**Step 6: 이상치(Outlier) 케이스 분석**
- **목적**: 극단적 성공/실패 케이스 및 예상 밖 케이스의 특징 발견
- **분석 방법**:
  - IQR, Z-score로 이상치 탐지
  - 극단 케이스 심층 분석 (초대박/대폭락)
  - 예상 vs 실제 차이 분석 (모델 예측 오차 큰 케이스)
  - 개별 케이스 스터디 및 외부 요인 조사
- **탐색 질문** (데이터가 답을 제공):
  - **극단적 성공 케이스(예: 2000%+)의 특징은?**
    - 어떤 팩터 조합이 나타나는가?
    - 일반 성공 케이스와의 차이점은?
    - 외부 요인(산업 호황, 정책 등)의 영향이 있는가?
  - **극단적 실패 케이스(예: -50%+)의 특징은?**
    - 어떤 팩터 조합이 나타나는가?
    - 일반 실패 케이스와의 차이점은?
    - 돌발 악재의 영향이 있는가?
  - **예상 밖 케이스의 특징은?**
    - 팩터가 약한데 성공한 케이스: 어떤 보완 요인이 있었나?
    - 팩터가 강한데 실패한 케이스: 어떤 결정적 약점이 있었나?
    - 모델이 예측하지 못한 숨은 변수가 있는가?

**Step 7: 패턴 검증 (Validation)**
- **목적**: 발견한 패턴의 통계적 유의성 및 일반화 가능성 검증
- **분석 방법**:
  - Bootstrap 리샘플링으로 패턴 재현성 확인
  - 시간대별 분할 검증 (예: Train 2015-2019, Test 2020-2024)
  - Permutation Test로 통계적 유의성 검증
  - Cross-validation으로 일반화 성능 확인
- **검증 질문** (데이터가 답을 제공):
  - **발견한 패턴이 시간에 따라 안정적인가?**
    - 다른 기간에서도 같은 패턴이 재현되는가?
    - 기간별로 팩터 중요도가 변하는가?
  - **발견한 패턴이 통계적으로 유의미한가?**
    - 우연에 의한 패턴인가, 실제 관계인가?
    - 샘플 크기가 충분한가?
  - **과적합 위험은 없는가?**
    - 너무 복잡하거나 세부적인 조건은 아닌가?
    - 일반화 가능한 패턴인가?

**분석 결과 산출물**:
- 팩터별 중요도 순위 및 상관계수
- 성공/실패 구분 팩터 리스트
- Level별 차별 팩터 리스트
- 시너지 효과가 있는 팩터 조합
- 세그먼트별 특성 및 차이점
- 검증된 패턴 및 신뢰구간
- 투자 전략 수립을 위한 인사이트

#### 3.3.2 지도 학습 - 성공 패턴 예측

**목적**: 알려진 성공 패턴 템플릿 기반으로 신규 케이스의 성공 확률 예측

**라벨링 전략**:


**모델 유형**:
- **분류 모델 (성공/실패)**
  - Random Forest, XGBoost, LightGBM
  - 신경망 (MLP)

- **회귀 모델 (수익률 예측)**
  - Gradient Boosting
  - 딥러닝: LSTM (시계열 특성 반영)

- **Multi-class 분류 (Level 0~4)**
  - XGBoost, LightGBM
  - 각 Level 달성 확률 예측

**특성 벡터 구성**:
```python
features = {
    # 거래량 블록
    'primary_trading_value_score': 7.5,
    'secondary_pattern': 'D+D+1',
    'secondary_trading_value_max': 2500,

    # 신고가 분석
    'new_high_grade': 'A',  # S/A/B/C/D/E/F
    'new_high_score': 8,

    # 당일 수급 (스냅샷)
    'is_d_foreign_institutional_buying': True,
    'd_foreign_institutional_net_buy': 27000000000,

    # 수급 트렌드
    'foreign_consecutive_buy_days': 35,
    'supply_demand_balance_score': 8.5,
    'dominance': 'foreign+institutional',

    # 재무제표 트렌드
    'has_turnaround': True,
    'consecutive_profit_quarters': 3,
    'equity_growth_rate': 42.9,

    # 산업 트렌드
    'is_future_industry': True,
    'future_industry_score': 9.0,
    'search_trend_score': 9.2,

    # ========== 섹터/테마 주도주 분석 (핵심 추가) ==========
    # 주도성 종합
    'leadership_score': 9.2,                       # 주도주 점수 (0-10)
    'leadership_grade': 'A',                       # S/A/B/C/D

    # 상대 강도 (Relative Strength)
    'relative_strength_percentile': 95.6,          # 섹터 내 상대 강도 백분위
    'outperformance_3m': 57.3,                     # 섹터 평균 대비 3개월 초과 수익률 (%)
    'outperformance_6m': 143.2,                    # 섹터 평균 대비 6개월 초과 수익률 (%)
    'is_early_mover': True,                        # 섹터 랠리 선행 여부
    'lead_days': 10,                               # 섹터 대비 선행 일수

    # 시장 지수 대비
    'vs_kospi_3m': 88.5,                           # KOSPI 대비 3개월 초과 수익률 (%)
    'vs_kospi_6m': 215.8,                          # KOSPI 대비 6개월 초과 수익률 (%)
    'vs_kosdaq_3m': 75.3,                          # KOSDAQ 대비 3개월 초과 수익률 (%)
    'vs_kosdaq_6m': 195.2,                         # KOSDAQ 대비 6개월 초과 수익률 (%)
    'sector_vs_kospi_6m': 85.5,                    # 섹터의 KOSPI 대비 6개월 초과 수익률 (%)
    'sector_vs_kosdaq_6m': 72.3,                   # 섹터의 KOSDAQ 대비 6개월 초과 수익률 (%)

    # 거래량 우위
    'trading_value_rank': 1,                       # 섹터 내 거래대금 순위
    'trading_value_ratio': 2.94,                   # 섹터 평균 대비 거래대금 배율
    'is_volume_leader': True,                      # 거래량 선행 주도 여부

    # 시가총액 및 수급
    'market_cap_rank': 1,                          # 섹터 내 시총 순위
    'market_cap_share': 22.5,                      # 섹터 시총 대비 점유율 (%)

    # 1번 블록 D일 수급
    'block_1_d_institutional_buy': 5000000000,     # 1번 블록 D일 기관 매수 금액 (원)
    'block_1_d_foreign_buy': 8000000000,           # 1번 블록 D일 외국인 매수 금액 (원)

    # 2번 블록 D일 수급
    'block_2_d_institutional_buy': 12000000000,    # 2번 블록 D일 기관 매수 금액 (원)
    'block_2_d_foreign_buy': 15000000000,          # 2번 블록 D일 외국인 매수 금액 (원)

    # 2번 블록 D+1일 수급
    'block_2_d1_institutional_buy': 8000000000,    # 2번 블록 D+1일 기관 매수 금액 (원)
    'block_2_d1_foreign_buy': 10000000000,         # 2번 블록 D+1일 외국인 매수 금액 (원)

    # 2번 블록 D+2일 수급
    'block_2_d2_institutional_buy': 6000000000,    # 2번 블록 D+2일 기관 매수 금액 (원)
    'block_2_d2_foreign_buy': 7000000000,          # 2번 블록 D+2일 외국인 매수 금액 (원)

    # 언론/이슈 주도성
    'is_sector_representative': True,              # 섹터 대표 종목 여부
    'sector_news_mention_ratio': 45.5,             # 섹터 뉴스 중 언급 비율 (%)
    'analyst_coverage': 18,                        # 애널리스트 커버리지 수
}
```

**예측 목표**:
❌ ~~매수/매도 신호 생성~~ (단기 트레이딩 아님)
✅ **장기 투자 성공 확률 및 리스크 예측**
  - **수익률 예측**
    - 50% 이상 달성 확률
    - Level 2 이상 달성 확률
    - 예상 최대 수익률 범위
  - **기간 예측**
    - 50% 도달까지 예상 소요 기간
    - 초단기/단기/중기/장기 분류 확률
  - **리스크 예측**
    - 예상 최대 낙폭(MDD)
    - MDD 심각도 (경미/보통/심각)
    - 리스크-수익 비율
  - **실패 확률 및 패턴**
    - 5년 후 50% 미달성 확률
    - 실패 시 예상 하락폭
    - 지속 하락 패턴 가능성

---

#### 지도 학습 상세 단계

##### Step 1: 특성 공학 (Feature Engineering)

**1.1 기본 특성 정규화 및 변환**

- **수치형 특성 스케일링**:
  - StandardScaler: 정규 분포 특성 (`equity_growth_rate`, `revenue_growth_rate`)
  - MinMaxScaler: 범위 정해진 특성 (`supply_demand_balance_score`, `future_industry_score`)
  - RobustScaler: 이상치 많은 특성 (`d_foreign_institutional_net_buy`, `trading_value`)

- **범주형 특성 인코딩**:
  - One-Hot Encoding: 순서 없는 범주 (`industry_category`, `market_type`)
  - Ordinal Encoding: 순서 있는 범주 (`new_high_grade`: F<E<D<C<B<A<S, `mdd_severity`)

**1.2 파생 특성 생성 (Derived Features)**

- **비율 및 복합 지표**:
  - `institutional_foreign_ratio`: 기관/외국인 순매수 비율
  - `block_intensity_ratio`: 2번/1번 블록 거래대금 비율
  - `financial_health_score`: 재무 건전성 복합 점수 (연속 흑자 40% + 자본 성장 30% + 매출 성장 30%)
  - `total_momentum_score`: 모멘텀 복합 점수 (수급 균형 50% + 산업 트렌드 30% + 검색 트렌드 20%)

- **주도주 파생 특성**:
  - `leadership_composite_score`: 주도성 복합 점수 (상대 강도 35% + 거래량 우위 25% + 시총 점유율 20% + 언론 주도성 20%)
  - `leader_high_grade_combo`: 주도주(S/A) × 신고가(S/A) 골든 크로스 (Boolean)
  - `non_leader_overvalued`: 주도성 부족(D) × 고평가(E/F) 위험 신호 (Boolean)
  - `outperformance_acceleration`: 섹터 초과 수익률 가속도 (6개월 - 3개월×2)
  - `leadership_sustainability`: 주도성 지속력 (선행 일수 + 섹터 대표성 + 애널리스트 커버리지)

- **시간 기반 특성**:
  - `block_month`, `block_quarter`, `is_year_end`: 계절성 및 연말 효과

**1.3 비지도 학습 결과 활용**

- **클러스터 정보**: 비지도 학습에서 발견한 클러스터 레이블 및 클러스터별 성공률
- **차원 축소 결과**: PCA, t-SNE 주요 컴포넌트 (component_1, component_2)
- **패턴 플래그**: 고위험-고수익 패턴 (MDD < -30% AND 최대수익률 > 500%)

**1.4 상호작용 특성 (Interaction Features)**

- **2-way 상호작용** (중요 특성 간 곱셈):
  - `financial_x_industry`: 재무 건전성 × 산업 트렌드
  - `supply_x_momentum`: 외국인 연속 매수일 × 2번 블록 거래대금
  - `leadership_x_financial`: 주도성 × 재무 건전성 (안정적 고수익)
  - `leadership_x_future_industry`: 주도성 × 미래 산업 (초고수익 Level 4)
  - `leadership_x_new_high`: 주도성 × 신고가 점수 (폭발적 상승)
  - `leadership_x_supply_demand`: 주도성 × 수급 강도 (지속 상승)
  - `relative_strength_x_volume`: 상대 강도 × 거래량 우위 (확실한 주도주)

- **3-way 상호작용**:
  - `triple_golden_combo`: 턴어라운드 × 미래산업 × 외국인+기관 매수
  - `leadership_golden_combo`: 주도주 × 미래산업 × 턴어라운드 (Level 4 확률 90%+)

- **Polynomial Features**: sklearn PolynomialFeatures(degree=2) 사용 (주요 특성만 선택)

**1.5 시계열 특성 (Time-Series Features)**

- **가격 패턴 클러스터**: DTW 분석 결과 활용 (비지도 학습 Step 4)
- **초기 수익률**: 1개월, 3개월, 6개월 수익률
- **변동성 지표**: 1개월 표준편차, 최대 낙폭(MDD)

##### Step 2: 모델 선택 및 학습

**2.1 분류 모델 1: 성공/실패 예측 (Binary Classification)**

**목표**: `is_success` (50% 이상 달성 여부) 예측

**모델 후보**:
- Logistic Regression (class_weight='balanced')
- Random Forest (n_estimators=200, max_depth=10, class_weight='balanced')
- XGBoost (n_estimators=200, max_depth=6,
        learning_rate=0.05,
        scale_pos_weight=len(y[y==0]) / len(y[y==1]),  # 클래스 불균형 처리
        random_state=42
    ),
    'lightgbm': LGBMClassifier(
        n_estimators=200,
        max_depth=6,
        learning_rate=0.05,
        class_weight='balanced',
        random_state=42
    ),
    'catboost': CatBoostClassifier(
        iterations=200,
        depth=6,
        learning_rate=0.05,
        auto_class_weights='Balanced',
        verbose=False,
        random_state=42
    ),
    'mlp': MLPClassifier(
        hidden_layers=(64, 32, 16),
        activation='relu',
        solver='adam',
        max_iter=500,
        random_state=42
    ),
}
```

**성능 지표**:


**2.2 분류 모델 2: Level 다중 분류 (Multi-class Classification)**

**목표**: `return_level` (0~4) 예측



**2.3 회귀 모델: 수익률 예측 (Regression)**

**목표**: `max_return_5y` (연속형 수익률) 예측



**2.4 기간 예측 모델: 수익 실현 시간 (Time-to-Event)**

**목표**: `days_to_50pct`, `time_to_target` 예측

```python
# Regression: days_to_50pct (연속형)
# 미달성 케이스(None) 처리:
# - 옵션 1: 최대값(1825일 = 5년)으로 대체
# - 옵션 2: 미달성 케이스 제외하고 학습

# Classification: time_to_target (범주형)
# 클래스: 초단기/단기/중기/장기/초장기/미달성

models_time = {
    'xgboost_reg': XGBRegressor(
        n_estimators=200,
        max_depth=6,
        learning_rate=0.05,
        random_state=42
    ),
    'lightgbm_clf': LGBMClassifier(
        n_estimators=200,
        max_depth=6,
        learning_rate=0.05,
        num_class=6,  # 6개 구간
        class_weight='balanced',
        random_state=42
    ),
}
```

**2.5 리스크 예측 모델: MDD 예측**

**목표**: `mdd_from_block_high` (연속형), `mdd_severity` (범주형)

```python
# Regression: MDD % 값 예측
models_mdd_reg = {
    'xgboost': XGBRegressor(
        n_estimators=200,
        max_depth=6,
        learning_rate=0.05,
        objective='reg:squarederror',
        random_state=42
    ),
}

# Classification: MDD 심각도 예측 (경미/보통/심각/매우심각)
models_mdd_clf = {
    'lightgbm': LGBMClassifier(
        n_estimators=200,
        max_depth=6,
        learning_rate=0.05,
        num_class=4,
        class_weight='balanced',
        random_state=42
    ),
}
```

##### Step 3: 교차 검증 및 하이퍼파라미터 튜닝

**3.1 시계열 고려 교차 검증 (Time-Series Split)**



**3.2 하이퍼파라미터 튜닝**



**3.3 클래스 불균형 처리**



##### Step 4: 모델 해석 (Model Interpretation)

**4.1 특성 중요도 (Feature Importance)**



**4.2 SHAP (SHapley Additive exPlanations)**



**4.3 부분 의존성 플롯 (Partial Dependence Plot)**



**4.4 개별 예측 설명 (Individual Prediction Explanation)**



##### Step 5: 앙상블 및 스태킹 (Ensemble & Stacking)

**5.1 Voting Classifier/Regressor**



**5.2 Stacking (Meta-Model)**



**5.3 Blending**



##### Step 6: 성능 평가 및 검증

**6.1 종합 성능 리포트**



**6.2 시간별 성능 검증 (Temporal Validation)**



**6.3 임계값 최적화 (Threshold Tuning)**



**6.4 오류 분석 (Error Analysis)**



##### Step 7: 최종 모델 선택 및 저장

**7.1 모델 비교 및 선택**



**7.2 모델 저장 및 버전 관리**



**7.3 프로덕션 배포 준비**



### 3.4 백테스팅

- 과거 데이터 기반 모델 성능 검증
- 거래 비용 고려
- 리스크 관리 전략 적용
- 성과 지표 측정 (수익률, 샤프 비율, MDD 등)

### 3.5 성과 분석 및 라벨링 전략

#### 3.5.1 성공 판단 기준

- **기준점**: 2번 거래량 블록의 고점 (D, D+1, D+2 중 최고가)
- **기본 성공 정의**: 5년 내 기준점 대비 **50% 이상 상승** 달성
- **실패 정의**: 5년 내 50% 상승 미달성

#### 3.5.2 수익률 구간 분류

**목적:** 50% 이상 상승한 케이스 중에서, 어떤 조건일 때 더 높이 상승하는지 분석

- **Level 1 (저수익)**: 50% ~ 100% 미만
- **Level 2 (중수익)**: 100% ~ 300% 미만
- **Level 3 (고수익)**: 300% ~ 1000% 미만
- **Level 4 (초고수익)**: 1000% 이상

**분석 목표:**
- 각 수익률 구간의 공통 특징 발견
- Level 1 → Level 4로 갈수록 어떤 팩터가 강화되는가?
- 특정 팩터 조합이 초고수익을 만드는가?

#### 3.5.3 주가 흐름 패턴 데이터 수집

**2번 블록 이후 5년간 추적 데이터:**
- **일별 데이터** (첫 1년):
  - 일별 OHLCV
  - 2번 블록 고점 대비 수익률
  - 이동평균선 (5일, 20일, 60일, 120일)
  - 거래량 변화

- **주별 데이터** (5년 전체):
  - 주봉 OHLCV
  - 주봉 120MA 기울기
  - 주별 최고/최저 수익률
  - 누적 수익률

- **주요 이벤트 데이터**:
  - 최고점 도달 시점 및 수익률
  - 최저점(MDD) 발생 시점 및 낙폭
  - 100% 달성 시점 (성공 케이스만)
  - 주요 조정 구간 (20% 이상 하락)

#### 3.5.4 라벨 설계

**성공 여부 라벨:**
- `is_50pct_success`: 50% 이상 상승 달성 여부 (Boolean)
- `return_level`: 수익률 구간 (0=실패, 1=Level1, 2=Level2, 3=Level3, 4=Level4)
  - 0: 50% 미만
  - 1: 50~100%
  - 2: 100~300%
  - 3: 300~1000%
  - 4: 1000% 이상

**수익률 지표:**
- `peak_return_pct`: 5년 내 최고 수익률 (%)
- `days_to_50pct`: 50% 달성까지 소요 일수
- `days_to_100pct`: 100% 달성까지 소요 일수 (달성 시)
- `days_to_peak`: 최고점 도달까지 소요 일수

**위험 지표:**
- `max_drawdown_pct`: 최대 낙폭 (%)
- `max_drawdown_days`: 최대 낙폭 발생 시점
- `volatility`: 수익률 표준편차

**패턴 지표:**
- `num_corrections`: 20% 이상 조정 횟수
- `avg_correction_pct`: 평균 조정 폭
- `recovery_speed`: 조정 후 회복 속도 (일수)

### 3.6 비지도 학습 (Unsupervised Learning)

**핵심 목표:** 팩터 기반 분석을 통해 수익률 구간별 차별 요인 발견

**접근 방식:**

- 1번+2번 블록 발생 케이스에서 재무/산업/수급/기술적 팩터 분석
- 클러스터링을 통해 Level 1~4를 구분하는 핵심 팩터 발견
- 어떤 조건일 때 50% → 100% → 1000%까지 상승하는지 규칙 도출

---

#### 3.6.1 수익률 구간별 패턴 발견

**목적:** 50% 이상 달성한 케이스들을 수익률 구간별로 분석하여 차이점 발견

**Step 1: 데이터 준비**
- 1번+2번 블록 발생 케이스 전체 수집 (10년 → 예상 100~500개)
- 50% 이상 달성 케이스만 필터링
- 각 케이스를 `return_level`로 분류 (Level 1~4)
- 각 케이스별 특성 벡터 구성:
  - **블록 특성**: 1번/2번 블록 거래량, 거래대금, 패턴 유형
  - **재무 특성**: 영업이익 증가율, 자본총계 증가율, ROE, 매출 증가율
  - **산업 특성**: 산업 분류, 미래산업 여부
  - **수급 특성**: 외국인/기관 매수세, 순매수 지속일
  - **시장 특성**: 발생 시점의 코스피 지수, 변동성, 강세장/약세장
  - **초기 모멘텀**: 2번 블록 이후 1개월/3개월/6개월 수익률

**Step 2: 수익률 구간별 클러스터링**
- **알고리즘**: K-means, DBSCAN, Hierarchical Clustering
- **목표**: 각 수익률 구간(Level 1~4) 내에서도 세부 패턴 발견
- **클러스터 분석**:
  - Level 1 (50~100%): 어떤 특징?
  - Level 2 (100~300%): 어떤 특징?
  - Level 3 (300~1000%): 어떤 특징?
  - Level 4 (1000%+): 어떤 특징?

**Step 3: 수익률 구간별 차별 요인 분석**
- 각 Level의 평균 특성 비교
- **발견 예시:**
  ```
  Level 4 (1000%+ 초고수익):
  - 영업이익 5년 연속 증가: 95%
  - 자본총계 5년 연속 증가: 90%
  - 미래산업 (AI, 2차전지 등): 85%
  - 2번 블록 이후 6개월 수익률 > 50%: 80%
  - 외국인/기관 순매수 6개월 지속: 75%

  Level 3 (300~1000% 고수익):
  - 영업이익 3년 연속 증가: 80%
  - 자본총계 3년 연속 증가: 75%
  - 미래산업 포함: 60%
  - 2번 블록 이후 6개월 수익률 > 30%: 70%

  Level 2 (100~300% 중수익):
  - 영업이익 증가 (연속성 약함): 60%
  - 자본총계 증가: 55%
  - 전통 산업: 50%

  Level 1 (50~100% 저수익):
  - 영업이익 변동성 큼: 40%
  - 재무 개선 미약
  - 초기 모멘텀 약함
  ```

**Step 4: 레벨 간 팩터 강도 비교**
- 각 팩터가 Level 1 → Level 4로 갈수록 어떻게 변하는지 시각화
- 예: 영업이익 증가 연속성 (1년 → 3년 → 5년)
- 예: 초기 모멘텀 (10% → 30% → 50%)

**Step 5: 주가 흐름 패턴 시각화**
- 각 Level별 평균 주가 흐름 차트
- t-SNE, PCA로 2D 시각화
- 시간대별 수익률 분포

#### 3.6.2 차트 패턴 시계열 클러스터링

**목적:** 주가 차트 시계열 패턴으로 수익률 구간 그룹화 및 분석

**Step 1: 차트 데이터 준비**
- 2번 블록 이후 N일간의 시계열 데이터 수집
  - **가격 시퀀스**: 일별 종가 정규화 (2번 블록 고점 = 100 기준)
  - **수익률 시퀀스**: [0%, 2%, -1%, 5%, 3%, ...] (첫 60~360일)
  - **거래량 시퀀스**: 일별 거래량 정규화
  - **이동평균선**: 5일, 20일, 60일, 120일 MA

**Step 2: 시계열 클러스터링 (DTW)**
- **알고리즘**: Dynamic Time Warping (DTW) 거리 기반 클러스터링
- **목적**: 유사한 주가 흐름 패턴끼리 그룹화
- **분석 구간**:
  - 초기 3개월 패턴
  - 초기 6개월 패턴
  - 1년 패턴

**Step 3: 패턴별 수익률 분석**
- 각 클러스터의 평균 최종 수익률 계산
- **발견 예시:**
  ```
  패턴 A (급등 후 안정):
  - 초기 3개월 50% 급등 → 6개월간 횡보 → 재상승
  - 평균 5년 수익률: 800%
  - Level 3~4에 주로 분포

  패턴 B (완만 상승):
  - 초기 6개월 30% 상승 → 꾸준한 우상향
  - 평균 5년 수익률: 200%
  - Level 2에 주로 분포

  패턴 C (초기 조정):
  - 초기 3개월 -10% 조정 → 느린 회복
  - 평균 5년 수익률: 80%
  - Level 1에 주로 분포
  ```

**Step 4: 차트 패턴 특징 추출**
- **모멘텀 지표**:
  - 초기 1개월/3개월/6개월 수익률
  - 최대 상승폭, 최대 하락폭

- **변동성 지표**:
  - 표준편차
  - ATR (Average True Range)
  - 조정 빈도 및 깊이

- **추세 지표**:
  - 이동평균선 배열 (정배열/역배열 지속일)
  - 이동평균선 기울기
  - 추세선 각도

- **거래량 패턴**:
  - 거래량 증가/감소 추세
  - 급등일 거래량 패턴
  - 거래량 이동평균 대비 비율

**Step 5: 패턴 시각화**
- 각 클러스터별 대표 차트 추출
- Level 1~4별 평균 주가 흐름 차트
- t-SNE로 패턴 2D 시각화

**Step 6: 실시간 패턴 매칭**
- 새로운 케이스 발생 시
- 초기 60~180일 차트 패턴 수집
- DTW 거리로 가장 유사한 과거 클러스터 찾기
- 해당 클러스터의 평균 성과 → 예상 수익률 추정

#### 3.6.3 팩터 중요도 분석

**목적:** 수익률 구간(Level 1~4)에 가장 영향을 주는 팩터 발견

**방법:**
1. **특성 중요도 분석**
   - Random Forest Feature Importance
   - SHAP (SHapley Additive exPlanations)
   - 순열 중요도 (Permutation Importance)
   - **타겟**: `return_level` (0~4) 또는 `peak_return_pct`

2. **상관관계 분석**
   - 각 팩터와 5년 수익률의 상관계수
   - 비선형 관계 탐지 (Mutual Information)
   - Level별 팩터 분포 비교

3. **조합 효과 분석**
   - 여러 팩터의 조합이 미치는 영향
   - 예: "영업이익 5년 증가 + 미래산업 + 초기 6개월 수익률 > 50%"
   - 고수익(Level 3~4)을 만드는 필수 조합 발견

**예상 발견:**
```
중요도 순위 (Level 4 달성 기준):
1. 2번 블록 이후 6개월 수익률 (40%)
2. 영업이익 연속 증가 년수 (25%)
3. 자본총계 연속 증가 년수 (15%)
4. 미래산업 포함 여부 (10%)
5. 외국인/기관 순매수 지속일 (7%)
6. 시장 강세장 여부 (3%)

필수 조합 (Level 4):
- 초기 6개월 수익률 > 50% AND 영업이익 5년 증가 → 확률 85%
- 초기 6개월 수익률 > 30% AND 미래산업 AND 자본총계 3년 증가 → 확률 70%
```

#### 3.6.4 비지도 학습 종합 - 팩터 + 차트 패턴 결합

**목적:** 재무 팩터 + 차트 패턴 클러스터링 결과를 결합하여 투자 전략 수립

**분석 방법:**
1. **팩터 스코어링**:
   - 영업이익 5년 증가: 5점, 3년 증가: 3점, 1년 증가: 1점
   - 자본총계 5년 증가: 5점, 3년 증가: 3점
   - 미래산업 포함: 3점
   - 합산 점수로 등급 분류

2. **차트 패턴 매칭**:
   - DTW로 과거 유사 패턴 찾기
   - 유사 패턴들의 평균 수익률

3. **결합 분석**:
   - 팩터 점수 高 + 차트 패턴 A → Level 4 확률
   - 팩터 점수 中 + 차트 패턴 B → Level 2~3 확률
   - 팩터 점수 低 + 차트 패턴 C → Level 1 확률

**발견된 패턴 → 투자 전략**

**1단계: 1번+2번 블록 발생 (필수 조건)**

**2단계: 팩터 점검 (선호 조건)**
- **Level 4 목표 조건**:
  - 영업이익 5년 연속 증가
  - 자본총계 5년 연속 증가
  - 미래산업 (AI, 2차전지, 바이오 등)
  - 팩터 점수 13점 이상

- **Level 3 목표 조건**:
  - 영업이익 3년 연속 증가
  - 자본총계 3년 연속 증가
  - 미래산업 포함 또는 산업 성장세
  - 팩터 점수 9~12점

- **Level 2 목표 조건**:
  - 영업이익 증가 추세 (연속성 약함)
  - 자본총계 증가
  - 팩터 점수 6~8점

**3단계: 초기 모니터링 (매수 후 3~6개월)**
- **Level 4 기대 차트 패턴**:
  - 초기 6개월 수익률 > 50%
  - 거래량 지속 증가
  - 외국인/기관 순매수 6개월 지속
  - DTW 패턴 매칭 → "급등 후 안정" 패턴

- **Level 3 기대 차트 패턴**:
  - 초기 6개월 수익률 > 30%
  - 거래량 안정적
  - DTW 패턴 매칭 → "완만 상승" 패턴

- **경고 패턴** (손절 고려):
  - 초기 3개월 수익률 < 0%
  - 거래량 급감
  - DTW 패턴 매칭 → "초기 조정" 패턴

**의사결정 매트릭스:**
```
팩터 점수 13+ AND 초기 6개월 수익률 > 50% → Level 4 기대 (보유)
팩터 점수 9~12 AND 초기 6개월 수익률 > 30% → Level 3 기대 (보유)
팩터 점수 6~8 AND 초기 6개월 수익률 > 20% → Level 2 기대 (보유)
팩터 점수 低 OR 초기 3개월 수익률 < 0% → 손절 고려
```

> **참고**:
> - 관점별 독립 분석은 3.3.1 Step 5 "세분화 및 관점별 분석"에 통합되었습니다.
> - 지도 학습 내용은 3.3.2 "지도 학습 - 성공 패턴 예측"을 참조하세요.

### 3.7 백테스팅 및 검증

> 이 섹션은 3.4 "백테스팅"을 참조하세요.

---

### 3.8 개발 단계별 계획

**Phase 1: 데이터 수집 및 블록 탐지 (4주)**
- 10년간 전체 종목 OHLCV 데이터 수집 (KOSPI + KOSDAQ)
- 재무제표 데이터 수집 (영업이익, 자본총계, ROE 등)
- 산업 분류 데이터 수집
- 1번 거래량 블록 탐지 알고리즘 구현
- 2번 거래량 블록 탐지 알고리즘 구현
- 1번+2번 블록 케이스 추출 (예상 100~500개)

**Phase 2: 성과 추적 및 라벨링 (3주)**
- 각 케이스별 5년간 주가 흐름 데이터 수집
  - 일별 데이터 (첫 1년)
  - 주별 데이터 (5년 전체)
- 2번 블록 고점 대비 100% 달성 여부 라벨링
- 최고 수익률, MDD, 조정 패턴 등 지표 계산
- 데이터셋 구축:
  - 특성 벡터 (블록, 재무, 산업, 수급, 시장)
  - 라벨 (is_100pct_success, peak_return_pct 등)

**Phase 3: 비지도 학습 - 패턴 발견 (4주)**
- 클러스터링 (K-means, DBSCAN, Hierarchical)
- 고성공/중성공/저성공 클러스터 분석
- 각 클러스터의 차별 요인 발견
- 주가 흐름 패턴 시각화 및 분석
- 시계열 클러스터링 (DTW)
- 팩터 중요도 분석 (Random Forest, SHAP)

**Phase 4: 전략 수립 및 백테스팅 (3주)**
- 발견된 패턴 기반 투자 전략 수립
  - 필수 조건: 1번+2번 블록
  - 선호 조건: 영업이익/자본총계 증가, 미래산업 등
  - 모니터링 지표: 초기 3개월 수익률, 거래량 등
- 전략 백테스팅 (10년)
- 성과 분석:
  - 100% 달성 확률
  - 평균 수익률 및 기간
  - MDD, 샤프 비율
- 전략 개선 및 최적화

**Phase 5: 문서화 및 시스템 구축 (2주)**
- 분석 결과 문서화
- 실시간 모니터링 시스템 구축
  - 1번+2번 블록 자동 탐지
  - 선호 조건 체크
  - 알림 시스템
- 최종 검토 및 배포

### 3.9 UI 개발 (PySide6)

#### 3.9.1 UI 프레임워크 및 아키텍처

**PySide6 선택 이유**
- Qt6 기반 공식 Python 바인딩 (LGPL 라이선스)
- 크로스 플랫폼 지원 (Windows, macOS, Linux)
- 풍부한 위젯 및 차트 컴포넌트
- 높은 성능 및 안정성
- 한글 및 다국어 완벽 지원

**아키텍처 패턴: MVP (Model-View-Presenter)**


**프로젝트 구조**
```
robostock/
├── main.py                      # 앱 진입점
├── ui/
│   ├── __init__.py
│   ├── main_window.py           # 메인 윈도우
│   ├── views/
│   │   ├── dashboard_view.py    # 대시보드
│   │   ├── stock_analysis_view.py  # 종목 분석
│   │   ├── block_monitor_view.py   # 블록 모니터링
│   │   ├── supply_analysis_view.py # 수급 분석
│   │   ├── portfolio_view.py    # 포트폴리오
│   │   └── settings_view.py     # 설정
│   ├── widgets/
│   │   ├── chart_widget.py      # 차트 위젯
│   │   ├── table_widget.py      # 테이블 위젯
│   │   ├── indicator_widget.py  # 지표 위젯
│   │   └── alert_widget.py      # 알림 위젯
│   ├── presenters/
│   │   ├── dashboard_presenter.py
│   │   ├── stock_presenter.py
│   │   └── chart_presenter.py
│   └── resources/
│       ├── icons/               # 아이콘
│       ├── styles/              # QSS 스타일시트
│       └── images/              # 이미지
├── models/                      # 데이터 모델 (기존)
├── collectors/                  # 데이터 수집 (기존)
├── analyzers/                   # 분석 모듈 (기존)
└── requirements.txt
```

#### 3.9.2 주요 UI 컴포넌트 및 화면

**1. 메인 윈도우 (MainWindow)**


**2. 대시보드 화면 (DashboardView)**
- **목적**: 전체 시장 현황 및 블록 발생 종목 모니터링
- **주요 기능**:
  - 오늘 발생한 1번 블록 종목 목록
  - 오늘 발생한 2번 블록 종목 목록 (투자 기회!)
  - 관심 종목 리스트 및 블록 진행 상태
  - 시장 지수 현황 (KOSPI, KOSDAQ)
  - 최근 알림 히스토리



**3. 종목 분석 화면 (StockAnalysisView)**
- **목적**: 개별 종목의 상세 분석 및 블록 히스토리
- **주요 기능**:
  - 종목 검색 (코드/이름)
  - 주가 차트 (캔들스틱 + 거래량 + 60일 이평선)
  - 블록 발생 히스토리 (과거 1번+2번 블록 표시)
  - 재무 지표 (영업이익, 자본총계, ROE 추세)
  - 수급 데이터 (외국인, 기관, 개인 누적 추세)
  - ML 예측 결과 (성공 확률, 예상 수익률)



**4. 블록 모니터링 화면 (BlockMonitorView)**
- **목적**: 1번 블록 발생 후 2번 블록 대기 중인 종목 모니터링
- **주요 기능**:
  - 1번 블록 발생 후 6개월 이내 종목 목록
  - 각 종목의 경과일, 현재가, 거래량 추이
  - 2번 블록 발생 가능성 점수
  - 알림 설정 (2번 블록 발생 시 알림)



**5. 수급 분석 화면 (SupplyAnalysisView)**
- **목적**: 시장 전체 또는 개별 종목의 수급 추세 분석
- **주요 기능**:
  - 외국인/기관/개인 일별 순매수 차트
  - 누적 순매수 추세선 (선형회귀)
  - 프로그램 매매 데이터
  - 수급 강도 지표 (buying_strength)
  - 수급 트렌드 필터링 (외국인+기관 강한 매수 종목)



**6. 포트폴리오 화면 (PortfolioView)**
- **목적**: 투자한 종목 관리 및 성과 추적
- **주요 기능**:
  - 보유 종목 목록 (매수일, 매수가, 현재가, 수익률)
  - 각 종목의 블록 진행 상태
  - 2번 블록 고점 대비 수익률
  - 매도 타이밍 알림 (100% 달성, MDD 위험)



#### 3.9.3 차트 위젯 구현

**StockChartWidget: 주가 차트 (matplotlib 통합)**


**SupplyChartWidget: 수급 추세 차트**


#### 3.9.4 데이터 바인딩 및 실시간 업데이트

**Presenter를 통한 데이터 흐름**


**실시간 업데이트 스레드**


#### 3.9.5 스타일링 (QSS)

**다크 테마 적용**


**스타일 적용 코드**


#### 3.9.6 알림 시스템

**시스템 트레이 알림**


#### 3.9.7 설정 화면

**사용자 설정 관리**


#### 3.9.8 개발 우선순위 및 일정

**Phase 1: UI 기본 구조 (2주)**
- [ ] PySide6 프로젝트 구조 생성
- [ ] MainWindow 및 탭 구조 구현
- [ ] 다크 테마 QSS 작성
- [ ] 기본 위젯 컴포넌트 개발

**Phase 2: 핵심 화면 개발 (3주)**
- [ ] DashboardView 구현 (1번/2번 블록 테이블)
- [ ] StockAnalysisView 구현 (차트 + 분석 탭)
- [ ] StockChartWidget 구현 (matplotlib 캔들스틱)
- [ ] BlockMonitorView 구현

**Phase 3: 데이터 연동 (2주)**
- [ ] Presenter 계층 구현
- [ ] DatabaseManager 연동
- [ ] Signal/Slot 데이터 바인딩
- [ ] 실시간 업데이트 스레드 구현

**Phase 4: 고급 기능 (2주)**
- [ ] SupplyAnalysisView 및 차트 구현
- [ ] PortfolioView 구현
- [ ] AlertManager 및 시스템 트레이
- [ ] SettingsDialog 구현

**Phase 5: 테스트 및 최적화 (1주)**
- [ ] UI 반응성 테스트
- [ ] 메모리 누수 체크
- [ ] 대용량 데이터 렌더링 최적화
- [ ] 사용자 피드백 반영

---

## 4. 기술 스택

### 4.1 언어 및 프레임워크
- **Python 3.x**
- 데이터 처리: pandas, numpy
- 시각화: matplotlib, seaborn, plotly
- 머신러닝: scikit-learn, xgboost, lightgbm
- 딥러닝: TensorFlow/Keras 또는 PyTorch
- 백테스팅: backtrader, zipline

### 4.2 데이터베이스
- PostgreSQL 또는 SQLite (데이터 저장)
- Redis (캐싱, 선택사항)

### 4.3 API
- 한국투자증권 API
- FinanceDataReader
- yfinance (해외 데이터 참고용)

## 5. 개발 일정

### Phase 1: 데이터 수집 및 인프라 구축 (3주)
- [ ] 개발 환경 설정 (Python, pandas, pykrx, dart-fss 등)
- [ ] 데이터 수집 API 연동
  - [ ] pykrx로 주가/거래/수급 데이터 수집
  - [ ] dart-fss로 재무제표 데이터 수집
  - [ ] pytrends로 검색 트렌드 데이터 수집
- [ ] 데이터베이스 설계 및 구축
- [ ] 10년치 KOSPI/KOSDAQ 전체 종목 데이터 수집
- [ ] **60일 이동평균선 계산 모듈 구현**
- [ ] **2년래 최대 거래량 탐지 알고리즘 구현**

### Phase 2: 거래량 블록 탐지 및 케이스 수집 (3주)
- [ ] **1번 거래량 블록 탐지 알고리즘 구현**
  - [ ] 2년래 최대 거래량 검증
  - [ ] 거래대금 500억원 이상 필터
  - [ ] D일 당일 수급 데이터 수집 (스냅샷)
  - [ ] 2년래 신고가 분석
- [ ] **2번 거래량 블록 탐지 알고리즘 구현**
  - [ ] 1번 블록 대비 80% 거래량 검증
  - [ ] 6개월 내 발생 확인
  - [ ] D+D+1, D+D+2, D+D+1+D+2 패턴 매칭
  - [ ] 4가지 필수 조건 검증 (고가 돌파, 거래대금, 패턴, 14일)
  - [ ] D, D+1, D+2 당일 수급 데이터 수집
  - [ ] 2년/5년/10년/역사적 신고가 분석
- [ ] **60이평선 기반 블록 범위 탐지**
  - [ ] 블록 종료일 탐지 (터치/하방이탈)
  - [ ] 블록 최고가 추출 (수익률 기준점)
- [ ] 1번+2번 블록 케이스 수집 (예상 100~500개)
- [ ] 데이터 품질 검증

### Phase 3: 트렌드 데이터 수집 및 통합 (2주)
- [ ] **재무제표 트렌드 데이터 수집**
  - [ ] 1번 블록 D일 기준 2년 전 ~ 현재까지
  - [ ] 영업이익, 자본총계, ROE/ROA 추이
  - [ ] 적자→흑자 전환 탐지
- [ ] **수급 트렌드 데이터 수집 (기간 분석)**
  - [ ] 2번 블록 D일 ~ 현재까지
  - [ ] 외국인/기관/개인 순매수 추세
  - [ ] 연속 매수일, 보유비중 변화
  - [ ] 수급 균형 점수 계산
  - [ ] 공매도/프로그램 매매 데이터
- [ ] **산업 트렌드 데이터 수집**
  - [ ] 1번 블록 D일 기준 2년 전 ~ 현재까지
  - [ ] 검색 트렌드 (네이버/구글)
  - [ ] 뉴스 감성 분석
  - [ ] 미래 산업 분류
  - [ ] R&D, 특허, 정부 지원금 데이터
- [ ] **장기 가격 흐름 데이터 (라벨링용)**
  - [ ] 2번 블록 고점 기준 5년간 추적
  - [ ] 수익률 구간 분류 (Level 0~4)
  - [ ] **기간 분석**: 50%/100% 도달 소요 일수
  - [ ] **MDD 분석**: 블록 고점 대비 최대 하락률 및 발생 시점
  - [ ] **실패 케이스 분석**: 지속 하락 패턴, 5년 후 최종 수익률
  - [ ] **리스크-수익 프로파일**: 리스크-수익 비율 계산
- [ ] 전체 데이터셋 통합 및 검증

### Phase 4: 비지도 학습 - 패턴 발견 (3주)
- [ ] **Step 1: 성공 vs 실패 팩터 분석 (Level 0 vs 1~4)**
  - [ ] 전체 케이스를 성공/실패로 2분류
  - [ ] Random Forest로 성공/실패 결정 팩터 추출
  - [ ] SHAP으로 팩터 순위화
  - [ ] 통계적 검정 (t-test, Mann-Whitney U)
  - [ ] **핵심 질문**: 수익 발생(50%+)에 결정적인 팩터는?
    - [ ] 신고가 등급의 임계값은? (C 이상?)
    - [ ] 외국인+기관 순매수 필수인가?
    - [ ] 재무 턴어라운드가 필요한가?
    - [ ] 미래 산업 여부의 영향은?
  - [ ] 실패 케이스(Level 0)의 공통 약점 분석

- [ ] **Step 2: 성공 케이스 내 Level별 차별 팩터 분석**
  - [ ] 성공 케이스(Level 1~4)만 필터링
  - [ ] K-means, DBSCAN, Hierarchical 클러스터링
  - [ ] PCA, t-SNE, UMAP으로 Level 분포 시각화
  - [ ] Random Forest 회귀로 Level 결정 팩터 추출
  - [ ] SHAP으로 고수익(Level 3~4) 조건 분석
  - [ ] **핵심 질문**: Level 1→4로 갈수록 강화되는 팩터는?
    - [ ] 신고가 등급의 상승 효과 (C→B→A→S)
    - [ ] 외국인+기관 순매수 금액 규모
    - [ ] 재무 개선 폭 (영업이익률, 자본총계)
    - [ ] 미래 산업 점수
    - [ ] 검색 트렌드/미디어 노출
  - [ ] 초고수익(Level 4) 케이스의 특별한 조건

- [ ] **Step 3: 시간/리스크 팩터 분석**
  - [ ] 수익률-기간-MDD 3차원 클러스터링
  - [ ] "고수익-빠름-낮은MDD" vs "고수익-느림-높은MDD" 구분
  - [ ] **수익 실현 기간**: 50% 도달까지 평균 기간, Level별 차이
  - [ ] **최대 낙폭(MDD)**: 블록 고점 대비 평균 하락률, Level별 차이
  - [ ] **리스크-수익 비율**: 최적 프로파일의 특징

- [ ] **종합 분석 리포트 작성**
  - [ ] 성공/실패 결정 팩터 정리 (필수/중요/선호 조건)
  - [ ] Level별 차별 팩터 정리 (Level 1→2→3→4 조건)
  - [ ] 실패 케이스 패턴 정리

### Phase 5: 지도 학습 - 성공 패턴 예측 모델 (3주)
- [ ] **데이터 라벨링 및 분할**
  - [ ] 성공/실패 라벨링 (50% 기준)
  - [ ] Level 0~4 분류
  - [ ] **기간 분류**: 초단기/단기/중기/장기/미달성
  - [ ] **MDD 심각도**: 경미/보통/심각/매우심각
  - [ ] **실패 케이스 분석**: 지속 하락 패턴 분류
  - [ ] Train/Validation/Test 분할
- [ ] **특성 벡터 구성**
  - [ ] 거래량 블록, 신고가, 당일 수급, 수급 트렌드
  - [ ] 재무제표, 산업 트렌드
- [ ] **모델 학습 및 비교**
  - [ ] 분류 모델: Random Forest, XGBoost, LightGBM
  - [ ] 회귀 모델: Gradient Boosting, LSTM
  - [ ] Multi-class 분류 (Level 0~4)
  - [ ] **기간 예측 모델**: 50% 도달 소요 일수 회귀
  - [ ] **MDD 예측 모델**: 최대 하락률 회귀
- [ ] **모델 평가**
  - [ ] Accuracy, Precision, Recall, F1-score
  - [ ] ROC-AUC, Confusion Matrix
  - [ ] 수익률 예측 정확도 (RMSE, MAE)
  - [ ] **기간 예측 정확도**: 50% 도달 일수 오차
  - [ ] **MDD 예측 정확도**: 하락률 오차
  - [ ] **실패 케이스 예측**: 정밀도/재현율
- [ ] **하이퍼파라미터 튜닝**

### Phase 6: 백테스팅 및 전략 검증 (2주)
- [ ] 백테스팅 프레임워크 구축
- [ ] 과거 10년 데이터 기반 전략 검증
  - [ ] 50% 달성 확률 검증
  - [ ] Level 2 이상 달성률
  - [ ] 평균 수익률 및 소요 기간
  - [ ] **기간 분석**: 50% 도달까지 평균 일수, 분포
  - [ ] **MDD 분석**: 평균 최대 하락률, 발생 시점
- [ ] 리스크 분석
  - [ ] MDD, 샤프 비율
  - [ ] 리스크-수익 비율 분포
  - [ ] **실패 케이스 분석**
    - [ ] 실패율 (50% 미달성)
    - [ ] 실패 시 평균 하락폭
    - [ ] 지속 하락 패턴 비율
- [ ] 성과 보고서 작성
  - [ ] 수익률/기간/리스크 종합 분석
  - [ ] Level별 성과 비교
  - [ ] 실패 케이스 패턴 정리

### Phase 7: 최적화 및 배포 (2주)
- [ ] 모델 최적화
- [ ] **실시간 모니터링 시스템 구축**
  - [ ] 1번+2번 블록 자동 탐지
  - [ ] 성공 확률 계산
  - [ ] 알림 시스템
- [ ] 문서화
- [ ] 최종 검토 및 배포

**총 예상 기간**: 18주 (약 4.5개월)

## 5. 프로젝트 구조

```
robostock/
├── data/                   # 데이터 저장
│   ├── raw/               # 원본 데이터
│   ├── processed/         # 전처리된 데이터
│   └── features/          # 특성 데이터
├── src/                   # 소스 코드
│   ├── data_collection/   # 데이터 수집
│   ├── preprocessing/     # 전처리
│   ├── features/          # 특성 엔지니어링
│   ├── models/            # 모델
│   ├── backtesting/       # 백테스팅
│   └── utils/             # 유틸리티
├── notebooks/             # Jupyter 노트북
├── tests/                 # 테스트 코드
├── config/                # 설정 파일
├── docs/                  # 문서
├── requirements.txt       # 의존성
└── README.md
```

## 6. 성과 지표

### 6.1 모델 성능
- 예측 정확도 (Accuracy)
- 정밀도 (Precision), 재현율 (Recall)
- F1 Score
- AUC-ROC

### 6.2 투자 성과
- 연평균 수익률 (CAGR)
- 샤프 비율 (Sharpe Ratio)
- 최대 낙폭 (MDD)
- 승률 (Win Rate)
- 손익비 (Profit Factor)

### 6.3 목표 성과
- 연평균 수익률: 10% 이상
- 샤프 비율: 1.0 이상
- 최대 낙폭: 20% 이하
- 승률: 55% 이상

## 7. 리스크 관리

### 7.1 기술적 리스크
- 데이터 품질 문제
- 과적합 (Overfitting)
- 컴퓨팅 리소스 부족

### 7.2 대응 방안
- 데이터 검증 프로세스 강화
- 교차 검증 (Cross-validation) 적용
- 클라우드 서비스 활용 검토

### 7.3 투자 리스크
- 시장 급변 대응
- 포트폴리오 다각화
- 손절매 규칙 설정

## 8. 향후 계획

### 8.1 단기 (3개월)
- 기본 모델 개발 및 백테스팅 완료
- 초기 성과 분석

### 8.2 중기 (6개월)
- 모델 개선 및 최적화
- 실전 투자 소규모 적용
- 성과 모니터링

### 8.3 장기 (1년+)
- 다양한 전략 추가
- 해외 주식 시장 확장
- 자동 매매 시스템 구축

## 9. 참고 사항

- 본 모델은 투자 참고용이며, 투자 손실에 대한 책임은 투자자 본인에게 있습니다
- 과거 데이터 기반 모델이므로 미래 수익을 보장하지 않습니다
- 지속적인 모델 업데이트 및 시장 모니터링이 필요합니다
